% -*- TeX-master: "sbml-level-2-version-3"; fill-column: 66 -*-
% $Id$
% $Source$
% ----------------------------------------------------------------

\section{Major changes between versions of SBML Level~2 and implications
  for backward compatibility}
\label{apdx:changes}

Relative to \sbmltwoone and \sbmltwotwo, the features removed in
\thisLV are as follows:
\begin{itemize}
  
\item The \token{offset} field on \UnitDefinition.  (See
  Section~\ref{sec:unit-structure}.)  The definition of offsets in
  \sbmltwoone was in fact incorrect; moreover, a proper
  implementation would have required a complete change in the SBML
  unit scheme.  Few models appeared to use offsets on unit
  definitions, so the impact of this change on models is expected
  to be small.
  
\item The \val{Celsius} predefined unit.  (See
  Section~\ref{sec:unit-structure}.)  The removal of offsets on
  unit definitions meant an inconsistency existed if the Celsius
  predefined unit was left in the system.  Removing Celsius
  removes the inconsistency.  Alternative ways of using Celsius
  are discussed in Section~\ref{sec:unit-structure}.
  
\item The \token{substanceUnit} and \token{timeUnits} fields on
  \KineticLaw.  (See Section~\ref{subsec:kinetic-law}.)  The
  ability to redefine the substance units on each reaction
  separately, coupled with other features in \sbmltwoone, created
  the opportunity for defining a valid system of reactions which
  potentially could not be combined into a consistent system of
  equations without external knowledge.

\item The \token{spatialSizeUnits} field on \Species.  (See
  Section~\ref{sec:species-units}.)  This field introduced an
  implicit unit conversion between the spatial units used in
  defining the quantity of a species and the size of the
  compartment in which the species was located.  Moreover, the
  semantics of \token{spatialSizeUnits} were confusing and
  required complicated unit conversions to be written explicitly
  into reaction rate expressions by either the modeler or the
  software.  Although the conversions could be worked out
  unambiguously, the potential for error was judged to exceed by
  far the utility of this feature.

\item The \token{timeUnits} field \Event.  (See
  Section~\ref{sec:events}.)  This field was judged to add
  needless complexity and inconsistency.  For instance, the
  ability to change the time units of the delay of an \Event to be
  different from the units of time for the whole model meant that
  computing an \Event's time of triggering and its delay might
  have to be done using two different sets of units.  The ability
  to redefine the units of time for the delay of an \Event was
  also inconsistent with the lack of such a field on other SBML
  components involving an element of time; for example, \RateRule,
  and now \KineticLaw, have no such fields.

\end{itemize}
Throughout the SBML specification, deprecated features are
explicitly indicated in the definitions of the constructs
affected.  The features deprecated in \sbmltwotwo and
\sbmltwothree are as follows:
\begin{itemize}
  
\item The \token{charge} field on \Species.  (See
  Section~\ref{sec:charge}.)  This field does not appear to be
  supported by any existing software, and moreover, since its
  value cannot be accessed from mathematical formulas in SBML, the
  impact of this change is expected to be small.

\end{itemize}

Despite these changes, \sbmltwothree is designed to be maximally
backward compatible with \sbmltwoone.  An XML document defining a
valid model in \sbmltwoone, after changing the XML namespace and
\token{version} attribute values on the \token{sbml} container
element (see Section~\ref{sec:sbml}), can become a valid
\sbmltwothree document, subject to the following provisions:
\begin{enumerate}
  
\item Any uses of the field \token{offset} on \UnitDefinition must
  be removed and the unit definitions or the model changed
  appropriately to account for this difference.  See
  Section~\ref{sec:unitdefinitions}.
  
\item Any references to the previously predefined unit
  \val{Celsius} must be removed and unit definitions or the model
  changed as needed to incorporate conversion between Celsius
  and kelvin degrees.  (The latter is predefined in SBML.)  See
  Section~\ref{sec:unitdefinitions}.
  
\item Any references to the previously defined fields
  \token{substanceUnits} and \token{timeUnits} on \KineticLaw
  must be removed and the model rewritten to incorporate the
  necessary unit conversions in some other fashion.  See
  Section~\ref{subsec:kinetic-law}.
  
\item Any references to the previously defined fields
  \token{spatialSizeUnits} on \Species must be removed and the
  model rewritten to incorporate the necessary unit conversions in
  some other fashion, for instance by redefining the initial value
  of the species quantity in terms of the units of size of the
  compartment in which the species is located.  See
  Section~\ref{sec:species}.

\item Any references to the previously defined fields
  \token{timeUnits} on \Event must be removed and the model
  rewritten to adjust the time delay as needed to be consistent
  with the overall time units of the model.  See
  Section~\ref{subsec:kinetic-law}.
  
\item \sbmltwoone did not clearly specify the value space of
  integer and floating-point numbers permitted in the MathML
  expressions in SBML; moreover, it used the XML Schema type
  \val{integer} instead of \sbmltwotwo's \val{int}.  Although
  extremely unlikely, some previously valid \sbmltwoone documents
  \emph{may} not be valid in Version~3 as a result of these
  changes.  See Sections~\ref{sec:integer}, \ref{sec:double}
  and~\ref{sec:cn-token} for more information.

\item \sbmltwoone did not define a default value for the field
  \token{fast} on \Reaction.  In \sbmltwotwo and Version~3, a
  default value \emph{is} defined, and the value is \val{false}.
  Further, software tools \emph{must} respect the value or
  indicate to the user that they do not have the capacity to do
  so.  See Section~\ref{sec:fast}.
  
\item \sbmltwothree is somewhat stricter about how the content of
  \token{annotation} elements must be organized and written..
  Previously valid \sbmltwoone documents \emph{may} need changes
  to their \token{annotation} elements to comply with the new
  specification.  See Section~\ref{sec:annotation-use} for more
  details.
  
\item \sbmltwothree is slightly stricter about how the content of
  \token{notes} elements must be organized.  Previously valid
  \sbmltwoone documents \emph{may} need changes to their
  \token{notes} elements to comply with the new specification.
  See Section~\ref{sec:notes} for more details.
  
\item \sbmltwothree corrects numerous errata and ambiguities
  discovered in \sbmltwoone and additional ones in \sbmltwotwo.
  These errata are listed on the project web site at
  \url{http://sbml.org}.  As a result of changes to \sbmltwo
  implied by these errata, some existing \sbmltwoone and
  \sbmltwotwo models, even when modified as explained above, may
  still not be compliant with Version~2.  The ultimate impact of
  the changes depends on the specific features used by a given
  model and the assumptions under which the model was created.

\end{enumerate}


