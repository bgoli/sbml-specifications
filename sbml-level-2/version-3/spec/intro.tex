% -*- TeX-master: "sbml-level-2-version-3"; fill-column: 66 -*-
% $Id$
% $Source$
% ----------------------------------------------------------------

\section{Introduction}
\label{sec:introduction}

We present the \textbf{S}ystems \textbf{B}iology \textbf{M}arkup
\textbf{L}anguage (SBML) \changed{\sbmltwothree}, a model
representation formalism for systems biology.  SBML is oriented
towards describing systems of biochemical reactions of the sort
common in research on a number of topics, including cell signaling
pathways, metabolic pathways, biochemical reactions, gene
regulation, and many others.  SBML is defined in a neutral fashion
with respect to programming languages and software encoding;
however, it is primarily oriented towards allowing models to be
encoded using XML, the eXtensible Markup
Language~\citep{bosak:1999,bray:2000}.  This document contains
many examples of SBML models written in XML, as well as the text
of an XML Schema~\citep{biron:2000,fallside:2000,thompson:2000}
that defines \changed{SBML Level~2 }\changed{Version~3}.  A
downloadable copy of the XML Schema and other related documents
and software are also available from the SBML project web site,
\url{http://sbml.org/}.

The SBML project is not an attempt to define a universal language
for representing quantitative models.  The rapidly evolving views
of biological function, coupled with the vigorous rates at which
new computational techniques and individual tools are being
developed today, are incompatible with a one-size-fits-all idea of
a universal language. A more realistic alternative is to
acknowledge the diversity of approaches and methods being explored
by different software tool developers, and seek a common
intermediate format---a \emph{lingua franca}---enabling
communication of the most essential aspects of the models.

The definition of the model description language presented here
does not specify \emph{how} programs should communicate or
read/write SBML.  We assume that for a simulation program to
communicate a model encoded in SBML, the program will have to
translate its internal data structures to and from SBML, use a
suitable transmission medium and protocol, etc., but these issues
are outside of the scope of this document.

%-----------------------------------------------------------------------------
\subsection{Developments, discussions, and notifications of updates}
%-----------------------------------------------------------------------------

% [MH 2006-03-06] This should still be changed to mention sbml-standard or
% whatever we use in the end, if we can decide in time for this spec.

SBML has been, and continues to be, developed in collaboration
with an international community of researchers and software
developers.  As in many projects, the primary mode of interaction
between members is electronic mail.  Discussions about SBML take
place on the mailing list
\link{http://sbml.org/forums}{sbml-discuss@caltech.edu}.  The
mailing list archives and a web browser-based interface to the
list are available at \url{http://sbml.org/forums/}.

Beginning with the release of \sbmltwotwo, a new low-volume,
broadcast-only mailing list is available where notifications of
revisions to the SBML specification, notices of votes on SBML
technical issues, and other critical matters are announced.  This
list is \link{http://sbml.org/forums}{sbml-announce@caltech.edu}
and anyone may subscribe to it freely.  This list will never be
used for advertising and its membership list will never be
disclosed.  \emph{It is vitally important that all users of SBML
  stay informed about revisions and other developments by
  subscribing to this list}, even if they do not wish to
participate in discussions on the
\link{http://sbml.org/forums}{sbml-discuss@caltech.edu} list.
Please visit the SBML project web site, \url{http://sbml.org/},
for information about how to subscribe to
\link{http://sbml.org/forums}{sbml-announce@caltech.edu} as well
as for access to the list archives.

In Section~\ref{sec:acknowledgements}, we attempt to acknowledge
as many contributors to SBML's development as we can, but as SBML
evolves, it becomes increasingly difficult to detail the
individual contributions on a project that has truly become an
international community effort.


%-----------------------------------------------------------------------------
\subsection{SBML Levels, Versions, and Revisions}
\label{sec:levels-versions-revisions}
%-----------------------------------------------------------------------------

Major releases of SBML are termed \emph{levels} and represent
substantial changes to the composition and structure of the
language.  The release of SBML defined in this document, \sbmltwo,
represents an incremental evolution of the language resulting from
the practical experiences of many users and developers working
with \sbmlone since since its introduction in the year
2001~\citep{hucka:2001,hucka:2003}.  All of the constructs of
Level~1 can be mapped to Level~2.  In addition, a subset of the
constructs in Level~2 can be mapped to Level~1.  However, the
levels remain distinct; a valid SBML Level~1 document is not a
valid SBML Level~2 document, and likewise, a valid SBML Level~2
document is not a valid SBML Level~1 document.

Minor releases of SBML are termed \emph{versions} and constitute
changes within an SBML Level to correct, adjust, and refine
language features.  The present document defines SBML Level~2
Version~\changed{3}.  \changed{In Section~\ref{sec:notation-color}
  below }\changed{explains how color is used in this document to
  indicate changes;} a separate document provides a detailed
listing of the changes between versions of \sbmltwo as well as
between \changed{\sbmltwothree} and \sbmlonetwo.

Specification documents inevitably require minor editorial changes
as its users discover errors and ambiguities.  As a practical
reality, these discoveries occur over time.  In the context of
SBML, such problems are formally announced publicly as
\emph{errata} in a given specification document.  Borrowing
concepts from the World Wide Web Consortium~\citep{jacobs:2004},
we define SBML errata as changes of the following types: (a)
formatting changes that do not result in changes to textual
content; (b) corrections that do not affect conformance of
software implementing support for a given combination of SBML
Level and Version; and (c) corrections that \emph{may} affect such
software conformance, but add no new language features.  A change
that affects conformance is one that either turns conforming data,
processors, or other conforming software into non-conforming
software, or turns non-conforming software into conforming
software, or clears up an ambiguity or insufficiently documented
part of the specification in such a way that software whose
conformance was once unclear now becomes clearly conforming or
non-conforming~\citep{jacobs:2004}.  In short, errata do not
change the fundamental semantics or syntax of SBML; they clarify
and disambiguate the specification and correct errors.  (New
syntax and semantics are only introduced in SBML Versions and
Levels.)

SBML errata result in new \emph{Revisions} of the SBML
specification.  Each revision is numbered with an integer, with
the first release of the specification being given the revision
number~1.  Subsequent revisions of an SBML specification document
contain a section listing the accumulated errata issued since the
first revision.  A complete list of the errata for \changed{\sbmltwothree}
since the publication of Revision~1 is also made publicly
available at
\url{http://sbml.org/specifications/sbml-level-2/version-\sbmlversion/errata/}.
Announcements of errata and revisions to the SBML specification,
as well as releases of new SBML Levels, are made on the
\link{http://sbml.org/forums}{sbml-announce@caltech.edu} mailing
list.


%-----------------------------------------------------------------------------
\subsection{Language features and backward compatibility}
\label{sec:deprecated-features}
%-----------------------------------------------------------------------------

Some language features of previous SBML Levels and Versions have
been either deprecated or removed entirely in \changed{\sbmltwothree}.  For
the purposes of SBML specifications, the following are the
definitions of \emph{deprecated feature} and \emph{removed
  feature}:
\begin{description}
  
\item \emph{Removed language feature}: A syntactic construct that
  was present in previous SBML Levels and/or Versions within a
  Level, and has been removed beginning with a specific SBML Level
  and Version.  Models containing such constructs do not conform
  to the specification of that SBML Level and Version.
  
\item \emph{Deprecated language feature}: A syntactic construct
  that was present in previous SBML Levels and/or Versions within
  a Level, and while still present in the language definition, has
  been identified as non-essential and planned for future removal.
  Beginning with the Level and Version in which a given feature is
  deprecated, software tools should not generate SBML models
  containing the deprecated feature; however, for backward
  compatibility, software tools reading SBML should support the
  feature until it is actually removed.

\end{description}

As a matter of SBML design philosophy, the preferred approach to
removing features is by deprecating them if possible.  Immediate
removal of SBML features is not done unless serious problems have
been discovered involving those features, and keeping them would
create logical inconsistencies or extremely difficult-to-resolve
problems.  The deprecation or outright removal of features in a
language, whether SBML or other, can have significant impact on
backwards compatibility.  Such changes are also inevitable over
the course of a language's evolution.  SBML must by necessity
continue evolving through the experiences of its users and
implementors.  Eventually, some features will be deemed unhelpful
despite the best intentions of the language editors to design a
timeless language.

Throughout the SBML specification, removed features are discussed
in the text of the sections where the features previously appeared.
The features removed in \changed{\sbmltwothree} are as follows:
\begin{itemize}
  
\item The \token{offset} field on \UnitDefinition.  (See
  Section~\ref{sec:unit-structure}.)  The definition of offsets in
  \sbmltwoone was in fact incorrect; moreover, a proper
  implementation would have required a complete change in the SBML
  unit scheme.  Few models appeared to use offsets on unit
  definitions, so the impact of this change on models is expected
  to be small.
  
\item The \val{Celsius} predefined unit.  (See
  Section~\ref{sec:unit-structure}.)  The removal of offsets on
  unit definitions meant an inconsistency existed if the Celsius
  predefined unit was left in the system.  Removing Celsius
  removes the inconsistency.  Alternative ways of using Celsius
  are discussed in Section~\ref{sec:unit-structure}.
  
\item The \token{substanceUnit} and \token{timeUnits} fields on
  \KineticLaw.  (See Section~\ref{subsec:kinetic-law}.)  The
  ability to redefine the substance units on each reaction
  separately, coupled with other features in \sbmltwotwo, created
  the opportunity for defining a valid system of reactions which
  potentially could not be combined into a consistent system of
  equations without external knowledge.

\begin{blockChanged}

\item The \token{spatialSizeUnits} field on \Species.  (See
  Section~\ref{sec:species-units}.)  This field introduced an
  implicit unit conversion between the spatial units used in
  defining the quantity of a species and the size of the
  compartment in which the species was located.  Moreover, the
  semantics of \token{spatialSizeUnits} were confusing and
  required complicated unit conversions.  Although the conversions
  could be worked out unambiguously, the potential for error was
  judged to exceed by far the utility of this feature.

\end{blockChanged}

\item The \token{timeUnits} field \Event.  (See
  Section~\ref{sec:events}.)  This field was judged to add
  needless complexity and inconsistency.  For instance, the
  ability to change the time units of the delay of an \Event to be
  different from the units of time for the whole model meant that
  computing an \Event's time of triggering and its delay might
  have to be done using two different sets of units.  The ability
  to redefine the units of time for the delay of an \Event was
  also inconsistent with the lack of such a field on other SBML
  components involving an element of time; for example, \RateRule,
  and now \KineticLaw, have no such fields.

\end{itemize}
Throughout the SBML specification, deprecated features are
explicitly indicated in the definitions of the constructs
affected.  The features deprecated in \sbmltwotwo are as follows:
\begin{itemize}
  
\item The \token{charge} field on \Species.  (See
  Section~\ref{sec:charge}.)  This field does not appear to be
  supported by any existing software\changed{, and moreover, since
    its value cannot be accessed from mathematical formulas in }
  \changed{SBML}, the impact of this change is expected to
  be small.

\end{itemize}

Despite these changes, \sbmltwotwo is designed to be maximally
backward compatible with \sbmltwoone.  An XML document defining a
valid model in \sbmltwoone, after changing the XML namespace and
\token{version} attribute values on the \token{sbml} container
element (see Section~\ref{sec:sbml}), can become a valid
\sbmltwotwo document, subject to the following provisions:
\begin{enumerate}
  
\item Any uses of the field \token{offset} on \UnitDefinition must
  be removed and the unit definitions or the model changed
  appropriately to account for \changed{this difference}.
  See Section~\ref{sec:unitdefinitions}.
  
\item Any references to the previously predefined unit
  \val{Celsius} must be removed and unit definitions or the model
  changed as needed to incorporate conversion between Celsius
  and kelvin degrees.  (The latter is predefined in SBML.)  See
  Section~\ref{sec:unitdefinitions}.
  
\item Any references to the previously defined fields
  \token{substanceUnits} and \token{timeUnits} on \KineticLaw
  must be removed and the model rewritten to incorporate the
  necessary unit conversions in some other fashion.  See
  Section~\ref{subsec:kinetic-law}.
  
\begin{blockChanged}

\item Any references to the previously defined fields
  \token{spatialSizeUnits} on \Species must be removed and the
  model rewritten to incorporate the necessary unit conversions in
  some other fashion, for instance by redefining the initial value
  of the species quantity in terms of the units of size of the
  compartment in which the species is located.  See
  Section~\ref{sec:species}.
  
\end{blockChanged}

\item \sbmltwoone did not clearly specify the value space of
  integer and floating-point numbers permitted in the MathML
  expressions in SBML; moreover, it used the XML Schema type
  \val{integer} instead of \sbmltwotwo's \val{int}.  Although
  extremely unlikely, some previously valid \sbmltwoone documents
  \emph{may} not be valid in Version~2 as a result of these
  changes.  See Sections~\ref{sec:integer}, \ref{sec:double}
  and~\ref{sec:cn-token} for more information.

\item \sbmltwoone did not define a default value for the field
  \token{fast} on \Reaction.  In \sbmltwotwo, a default value
  \emph{is} defined, and the value is \val{false}.  Further,
  software tools \emph{must} respect the value or indicate to the
  user that they do not have the capacity to do so.  See
  Section~\ref{sec:fast}.
  
\item \sbmltwotwo is somewhat stricter about how the content of
  \token{annotation} elements must be organized and written..
  Previously valid \sbmltwoone documents \emph{may} need changes
  to their \token{annotation} elements to comply with the new
  specification.  See Section~\ref{sec:annotation-use} for more
  details.
  
\item \sbmltwotwo is slightly stricter about how the content of
  \token{notes} elements must be organized.  Previously valid
  \sbmltwoone documents \emph{may} need changes to their
  \token{notes} elements to comply with the new specification.  See
  Section~\ref{sec:notes} for more details. 
  
\item \sbmltwotwo corrects numerous errata and ambiguities
  discovered in \sbmltwoone.  These errata are listed on the
  project web site at \url{http://sbml.org}.  As a result of
  changes to \sbmltwo implied by these errata, some existing
  \sbmltwoone models, even when modified as explained above, may
  still not be compliant with Version~2.  The ultimate impact of
  the changes depends on the specific features used by a given
  model and the assumptions under which the model was created.

% Mike - really we ought to identify these cases.  With more time
% I could go through the errata list...

\end{enumerate}


%-----------------------------------------------------------------------------
\subsection{\changed{Document} conventions}
\label{sec:notation}
%-----------------------------------------------------------------------------

\begin{blockChanged}

In this section, we describe the conventions we use in this
specification document in an effort to communicate information
more effectively and consistently.


\subsubsection{Color conventions}
\label{sec:notation-color}

Throughout this document, we use coloring to carry additional
information for the benefit of those viewing the document on media
that can display color:

\begin{itemize}

\item We use red color in text and figures to indicate change
  between this version of the specification (\thisLVR) and the
  \emph{most recent previous version} of the specification (which,
  for the present case, is \sbmltwotwo Revision~1).  The changes
  may be either additions or deletions of text; in the case of
  deletions, the entire affected paragraph or entire section is
  colored red to indicate a change occurred.

\item We use blue color in text to indicate a hyperlink from one
  point in this document to another.  Clicking your computer's
  pointing device on blue-colored text will cause a jump to the
  section, figure, table or page to which the link refers.  (Of
  course, this capability is only available when using electronic
  formats that support a hyperlinking facility, such as PDF and
  HTML.)

\end{itemize}

\end{blockChanged}

\subsubsection{Typographical conventions for names}
\label{sec:notation-typographical}

The following typographical notations are used in this document to
distinguish object classes from other kinds of entities:

\begin{description}
  
\item \abstractclass{AbstractClass}: Abstract classes are classes
  that are never instantiated directly, but rather serve as
  parents of other classes.  Their names begin with a capital
  letter and they are printed in a slanted, \changed{bold},
  sans-serif typeface.  In electronic document formats, the class
  names are also hyperlinked to their definitions in the
  specification.  For example, in the PDF and HTML versions of
  this document, clicking on the word \SBase will send the reader
  to the section containing the definition of this class.
  
\item \class{Class}: Names of ordinary (concrete) classes begin
  with a capital letter and are printed in an upright,
  \changed{bold}, sans-serif typeface.  In electronic document
  formats, the class names are also hyperlinked to their
  definitions in the specification.  For example, in the PDF and
  HTML versions of this document, clicking on the word \Species
  will send the reader to the section containing the definition of
  this class.

\item \token{SomeThing}, \token{otherThing}: \changed{Attributes} of
  classes, primitive data type names, literal XML strings, and
  generally all tokens \emph{other} than SBML UML class names, are
  printed in an upright typewriter typeface.  Primitive types
  defined in SBML begin with a capital letter, but unfortunately,
  \xmlschemaone does not follow any convention and primitive XML
  types may either start with a capital letter (e.g,.
  \primtype{ID}) or not (e.g., \primtype{double}).

\end{description}


\begin{blockChanged}

\subsubsection{UML notation}
\label{sec:notation-uml}

% fixme: use primary citations for UML below

Previous specifications of SBML used a notation that was at one
time (in the days of \sbmlone) fairly close to UML, the Unified
Modeling Language~\citep{eriksson:1998,oestereich:1999}, though
many details were omitted from the UML diagrams themselves.  Over
the years, the notation used in successive specifications of SBML
grew increasingly less UML-like.  Beginning with \sbmltwothree, we
have completely overhauled the specification's use of UML and once
again define the syntax of SBML using, as much as possible, proper
and complete UML~1.0.  We then systematically map this UML
notation to XML, using XML
Schema~\citep{biron:2000,fallside:2000,thompson:2000} to express
the overall syntax of SBML.  In the rest of this section, we
summarize the UML notation used in this document and explain the
few embellishments needed to support transformation to XML form.
A complete Schema for SBML is given in Appendix~\ref{apdx:schema}.

We see three main advantages to using UML as a basis for defining
SBML data structures.  First, compared to using other notations or
a programming language, the UML visual representations are
generally easier to grasp by readers who are not computer
scientists.  Second, the notation is implementation-neutral: the
defined structures can be encoded in any concrete implementation
language---not just XML, but C, Java and other languages as well.
Third, UML is a de facto industry standard that is documented in
many resources.  Readers are therefore more likely to be familiar
with it than other notations.


\paragraph{Object class definitions}

Object classes in UML diagrams are drawn as simple tripartite
boxes, as shown in Figure~\ref{fig:simple-class-eg} (left).  UML
allows for operations as well as data attributes to be defined,
but SBML only uses data attributes, so all SBML class diagrams use
only the top two portions of a UML class box (see the right-hand
diagram of Figure~\ref{fig:simple-class-eg}).

\begin{figure}[htb]
  \centering
  \small
  \begin{blockChanged}
    \begin{classbox}{Class Name}
      attributes\\
      \hline
      operators\\
    \end{classbox}
    \quad  \quad
    \begin{classbox}{ExampleClass}
      attribute: int \\
      anotherAttribute: double\\
    \end{classbox}
  \end{blockChanged}
  \caption{\changed{(Left) The general form of a UML class
      diagram.  (Right) Example of a class diagram of the sort
      seen in SBML.  SBML classes never use operators, so SBML
      class diagrams only show the top two parts.}}
  \label{fig:simple-class-eg}
\end{figure}

As mentioned above, the names of ordinary (concrete) classes begin
with a capital letter and are printed in an upright,
\changed{bold}, sans-serif typeface.  The names of attributes
begin with a lower-case letter and generally use a mixed case
(sometimes called ``camel case'') style when the name consists of
multiple words.  Attributes and their data types appear in the
part below the class name, with one attribute defined per line.
The colon character on each line separates the name of the
attribute (on the left) from the type of data that it stores (on
the right).  The subset of data types permitted for SBML
attributes is given in Section~\ref{sec:primitive-types}.

In the right-hand diagram of Figure~\ref{fig:simple-class-eg}, the
symbols \token{attribute} and \token{anotherAttribute} represent
attributes of the object class \class{ExampleClass}.  The data
type of \token{attribute} is \primtype{int}, and the data type of
\token{anotherAttribute} is \primtype{double}.  In the scheme used
by SBML for translating UML to XML, object attributes map directly
to XML attributes.  Thus, in XML, \class{ExampleClass} would yield
an element of the form \token{<element attribute="42"
  anotherAttribute="10.0">}.

Notice that the element name is not \token{<ExampleClass ...>}.
Somewhat paradoxically, the name of the element is \emph{not} the
name of the UML class defining its structure.  The reason for this
may be subtle at first, but quickly becomes obvious: object
classes define the form of an object's \emph{content}, but a class
definition by itself does not define the \emph{label} or symbol
referring to an instance of itself.  It is this label that becomes
the name of the XML element.  It is much the same in a programming
language: defining object classes is all well and good, but we
cannot manipulate an instance of the class until we create a
symbol to serve as a handle for the instance.  In XML, this symbol
is most naturally equated with an element name.  This point will
hopefully become more clear with additional examples below.


\paragraph{Subelements}

We use UML composite aggregation to indicate a class object can
have other class objects as parts.  Such containment structures
map directly to element-subelement relationships in XML.
Figure~\ref{fig:subelement-eg} gives an example of this.

\begin{figure}[htb]
  \centering
  \small
  \vspace*{-1ex}
  \begin{tikzpicture}[level distance=0.7in]
    \node[left=0.3in] (a) {
      \begin{classbox}{Whole}
        A: int \\
        B: string \\
      \end{classbox}
    };
    \node[right=0.3in] (b) {
      \begin{classbox}{Part}
        C: double \\
      \end{classbox}
    };
    \draw[diamond-,shorten >=-6pt] (a) -- (b)
      node[left=0.8in,above=2pt] {\textsf{inside}};
  \end{tikzpicture}
  \caption{changed{Example illustrating composite
      aggregation---the definition of one class of objects
      employing another class of objects in a part-whole
      relationship.  In this particular example, an instance of a
      \class{Whole} class object must contain exactly one instance
      of a \class{Part} class object, and the symbol referring to
      the \class{Part} class object is \token{inside}.  In XML,
      this symbol becomes the name of a subelement and the content
      of the subelement follows the definition of \class{Part}.}}
  \label{fig:container-eg}
\end{figure}

The line with the black diamond indicates composite aggregation,
with the diamond located on the ``container'' side and the other
end located at the object class being contained.  The label on the
line is the symbol used to refer to instances of the contained
object, which in XML, maps directly to the name of an XML element.
The class pointed to by the aggregation relationship (\class{Part}
in Figure~\ref{fig:container-eg}) defines the \emph{contents} of
that element.  Thus, if we are told that some element named
\token{barney} is of class \token{Whole}, the following is an
example XML fragment consistent with the class definition of
Figure~\ref{fig:container-eg}:

\begin{example}
<barney A="110" B="some string">
    <inside C="444.4">
</barney>
\end{example}

Sometimes numbers are placed on the ``contained'' side of an
aggregation to indicate how many instances can be contained:
\token{[0..*]} signifies a list containing zero or more,
\token{[1..*]} signifies a list containing at least one, and
\token{[0..1]} signifies zero or one.  This usage appears
throughout this specification document.


\paragraph{Inheritance}

\begin{wrapfigure}[18]{r}{2.25in}
  \centering
  \small
  \vspace*{-4ex}
  \begin{tikzpicture}[level distance=0.75in]
    \node { 
      \begin{classbox}{Parent}
        A: int           \\
        B: boolean \\
      \end{classbox}
    }
    [open triangle 60-,edge from parent fork down,sibling distance=2.15in]
    child {node (a) {
        \begin{classbox}{Child}
          C: int \\
          D: string \\
        \end{classbox}
      }}
    ;
  \end{tikzpicture}
  \caption{Inheritance.}
  \label{fig:inheritance-eg}
\end{wrapfigure}
Classes can inherit properties from other classes.  Since SBML
only uses data attributes and not operations, inheritance in SBML
simply involves data attributes from a parent class being
inherited by child classes.  Inheritance is indicated by a line
between two classes, with an open triangle next to the parent
class; Figure~\ref{fig:inheritance-eg} illustrates this.  In this
example, the instances of object class \class{Child} would have
not only attributes \token{C} and \token{D}, but also attributes
\token{A} and \token{B}.  All of these attributes would be
required (not optional) on instances of class \class{Child}
because they are mandatory on both \class{Parent} and
\class{Child}.



\paragraph{Additional notations for XML purposes}

Not everything is easily expressed in plain UML.  For example, it
is often necessary to indicate some constraints placed on the
values of an attribute.  In programming contexts involving UML,
such constraints are often expressed using Object Constraint
Language (OCL), but since we are most interested in the XML
rendition of SBML, in this specification we XML Schema (when
possible) as the language for expressing value constraints.
Constraints on the values of attributes are written as expressions
in curly braces (\token{\{\}}) after the data type declaration, as
in the example of Figure~\ref{fig:unit-eg}.

\begin{figure}[htb]
  \centering
  \small
  \vspace*{-1ex}
  \begin{tikzpicture}[level distance=0.7in]
    \node { \emptyClassbox{\textsl{SBase}} }
      [open triangle 60-,edge from parent fork down,sibling distance=2.5in]
      child {node (a) {
          \begin{classbox}{Sbml}
            level: positiveInteger \{ use="required" fixed="2" \}   \\
            version: positiveInteger \{ use="required" fixed="\changed{3}" \} \\
          \end{classbox}
        }}
      child {node (b) {
          \emptyClassbox{Model}
        }}
     ;
     \draw[diamond-] (a) -- (b) 
       node[above=6pt,left=40pt] {\textsf{model}};
  \end{tikzpicture}
  \caption{\changed{A more complex example definition drawing on
      the concepts introduced so far in this section.  Both
      \class{Sbml} and \class{Model} are derived from
      \abstractclass{SBase}; further, \class{Sbml} contains a
      single \class{Model} object named \token{model}.  Note the
      constraints on the values of the attributes in \class{Sbml};
      they are enclosed in curly braces and written in XML Schema
      language.  The particula constraints here state that both
      the \token{level} and \token{version} attributes must be
      present, and that the values are fixed as indicated.}}
  \label{fig:eg}
\end{figure}

In other situations, when something cannot be concisely expressed
using a few words of XML Schema, we write constraints using
English language descriptions enclosed in curly braces
(\token{\{\}}).  The text accompanying all SBML component
definitions provides explanations of the constraints and any other
conditions applicable to the use of the components.


\paragraph{Compatibility issues and warnings}

One important and confusing point that goes against the grain of
XML must be highlighted: the order in which subelements appear
within SBML elements \emph{is} significant and \emph{must} follow
the order given in the corresponding object definition.  This
ordering is also difficult to express in plain UML, so we resort
to using the approach of stating ordering requirements as
constraints written in English and (again) enclosed in curly
braces (\token{\{\}}).  Figure~\vref{??} gives an example of this.

The ordering restriction also holds true when a subclass inherits
fields from a base class: the base class field elements must occur
before those introduced by the subclass.

This ordering constraint stems from aspects of XML Schema beyond
ou control (specifically, the need to use XML Schema's
\token{sequence} construct to define the object classes).  It is
an occasional source of software compatibility problems:
validating XML parsers will generate errors if the field ordering
of an XML element does not correspond to the SBML object class
definition.


\end{blockChanged}
