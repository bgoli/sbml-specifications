\documentclass{cekarticle}
\usepackage{color}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{array}

\begin{document}

%=============================================================================
% Title page
%=============================================================================

\title{Systems Biology Markup Language (SBML) Level 3 Proposal: Array Features}

\author{Andrew Finney, Victoria Gor, Ben Bornstein, Eric Mjolsness}

\authoremail{
\begin{minipage}{\textwidth}\centering
afinney@cds.caltech.edu, gor@aig.jpl.nasa.gov, bornstei@aig.jpl.nasa.gov\\emj@uci.edu
\end{minipage}}

\maketitlepage

%=============================================================================
\section{Introduction}
\label{sec:introduction}
%=============================================================================

This document describes proposed features for inclusion in
Systems Biology Markup Language (SBML) Level 3. This document
describes features enabling the inclusion of arrays of processes,
structures or entities in models.  These features would allow a
model to be assembled from many copies of identical parts.  These
features enable the representation of patterns of connection
amongst array elements.

This document is not a definition of SBML Level 3 or part of it.
This document simply presents various features which could be
incorporated into SBML Level 3 as the Systems Biology community
wishes.  This document is intended for detailed review by that
community and to provoke alternative proposals.  Throughout this
document issues that the authors believe will require further
discussion have been highlighted.

For brevity the text of this document is with reference to SBML
Level 2~\citep{finney:2002f} i.e. features are described in terms
of changes to SBML Level 2.  
This document
also refers to another Level 3 proposal on model composition~\citep{finney:2003b}.
In addition for brevity the UML diagrams in this proposal
show only new attributes and types for SBML Level 3.  For SBML Level 2 types Level 2
attributes are meant to be present in SBML Level 3.  All the types and attributes
proposed in the model composition are assumed to be present.
All types proposed in this document will be derived from the
\texttt{SBase} type.

\section{Models}

The proposed structure of the \texttt{Model} type is shown in
figure~\ref{fig:model}. A model would have an optional list of
\texttt{IntegerParameter} structures.

\begin{figure}[h]
  \vspace*{8pt}
  \centering
  \includegraphics[scale = 0.7]{model}
  \caption{The definition of the Model and IntegerParameter types}
  \label{fig:model}
\end{figure}

The \class{IntegerParameter} type is described in section~\ref{sec:integerParameters}.

\section{Integer Parameters}
\label{sec:integerParameters}

The \class{IntegerParameter} type is shown in figure~\ref{fig:model}.
\class{IntegerParameter} structures declare integer constants with identifiers in the model's global identifier namespace.
They can be used in any MathML expression where they have an implicit type of \texttt{integer}.
They are distinct from \class{Parameter} structures: it is not possible to define a rule for an \class{IntegerParameter}.

\section{Constant Expressions}
\label{sec:constantExpressions}

A constant expression is an expression whose result doesn't vary during simulation.
The only symbols occurring constant expression are those representing integer variables (declared by \attrib{Dimension} structures)
or integer parameters.  A constant expression is required in the \attrib{elementExists} field.

\section{Integer Expressions}

In some cases in the proposal a MathML expression is restricted to returning an integer result.
An integer expression is composed of integer numbers, symbols representing integer variables (declared by \attrib{Dimension} structures)
or integer parameters and
operators that return integer values given integer arguments.  Integer expressions are required in the
\attrib{dimension} and \rule{0.5in}{0.5pt}\attrib{Index} fields in this proposal. In addition the arguments for the
MathML \texttt{selector} operator should be integer expressions.

Because none of the symbols in integer expressions vary at simulation time an integer expression can be considered constant.

\section{Arrays}
\label{sec:arrays}

The core of this proposal is the idea that almost all the
structures in SBML can be defined as arrays as well as single
named objects.  We propose that following SBML types,
\texttt{Instance}, \texttt{Link}, \texttt{Species}, \texttt{Compartment}, \texttt{Reaction},
\texttt{Parameter} and \texttt{Rule} can be defined as arrays of
objects.  Figure~\ref{fig:arrays} summarizes the changes made
to these structures.

\begin{figure}[htb]
  \centering
  \includegraphics[scale = 0.68]{arrays}
  \caption{Changes made to existing SBML Level 2 structures with related additional structures}
  \label{fig:arrays}
\end{figure}


\subsection{Array Declaration}
\label{sec:arraydec}
The presence of a \attrib{dimension} field
(\texttt{listOfDimensions} sub-element) indicates that the given
structure is an array rather than a single object.  Each \class{Dimension} structure in this field defines
the array cells in one dimension of the array.

A dimension structure declares an integer symbol that takes integer values over a defined range.  
Array cells exists on the given dimension for each value of the integer symbol.  The range of values
is defined by the inclusive range between the results of the \texttt{upperLimit} and \texttt{lowerLimit}
MathML expressions.  These expressions must return an integer result.  The integer symbol iteratively takes on the
value in the range and has scope within the other MathML expression contained by the SBML component element
except for \class{Dimension} structures preceding the given \class{Dimension} structure in \texttt{listOfDimensions}.

All the objects in the
array have the properties described by the structures's
attributes and substructures.
Structures that are declared as arrays share the same namespace
as those structures that represent single objects.

The following SBML model shows a \texttt{Compartment}
structure representing a 1 dimensional array consisting of
a cells located in the array from a positions 0 to 9 inclusive.

\begin{example}
<model id="simple">
    <listOfCompartments>
        <compartment id="cell">
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
        </compartment>
    </listOfCompartments>
</model>
\end{example}

\subsection{Array Element Object Reference}

As shown in figure~\ref{fig:arrays} it is proposed that structures
which refer to other structures have \rule{0.5in}{0.5pt}\attrib{Index} fields
(\texttt{listOf}\rule{0.5in}{0.5pt}\attrib{Indices} sub-elements) for example the type \class{SimpleSpeciesReference}
has a \attrib{speciesIndex} field.  These fields provide the index of
the relevant referenced object with in an array. 

These index fields should contain one integer expression for each dimension of the array being accessed.

We can use the \attrib{containerIndex} field on a \class{Species} structure to create an array of species
distributed across an array of compartments:
\begin{example}
<model id="ref">
    <listOfCompartments>
        <compartment id="cell">
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
        </compartment>
    </listOfCompartments>
    <listOfSpecies>
        <species id="s" compartment="cell"/>
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
            <listOfContainerIndices>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <ci> x </ci>
                </math>
            </listOfContainerIndices>
        </species>
    </listOfSpecies>
</model>
\end{example}
In this example each species array element is placed in a
corresponding compartment array element.

\subsection{Array Element Reference In MathML}
In this section mechanisms within a a math expression, for accessing specific elements of an
array, are described.

In MathML expressions components declared as arrays can be referenced using \texttt{ci} elements.
However this will represent an matrix or vector of the values of the component's elements as opposed
to a single scalar value.
In MathML expressions the \texttt{selector} operator
can be applied to such an array symbol (vector or matrix in MathML) and
returns the appropriate value of the indexed array element.
The `array' operand of a \texttt{selector} operator must be the name of a
structure which has been declared as an array.  The index arguments must integer expressions.

\subsubsection{Example of using element references in both numeric and object reference fields}

The following example fragment shows how the array operator can be used in
a numeric expression.  
\begin{example}
<math xmlns="http://www.w3.org/1998/Math/MathML">
    <apply>
        <times/>
        <apply>
            <selector>
            <ci> s1 </ci>
            <ci> x </ci>
        </apply>
        <cn> 0.1 </cn>
    </apply>
</math>
\end{example}

\texttt{s1} is an array and \texttt{x} is an integer symbol or parameter.
The whole model follows.  This model contains 2 arrays of 10 species and defines
a set of 10 reactions between corresponding pairs of species. The rate equation
for this set of reactions uses the \texttt{selector} element to reference the reactant species.

\begin{example}
<model id="ref">
    <listOfCompartments>
        <compartment id="cell"/>
    </listOfCompartments>
    <listOfSpecies>
        <species id="s1" compartment="cell"/>
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
        </species>
        <species id="s2" compartment="cell"/>
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
        </species>
    </listOfSpecies>
    <listOfReactions>
        <reaction id="r">
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
            <listOfReactants>
                <speciesReference species= "s1">
                    <listOfSpeciesIndices>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> x </ci>
                        </math>
                    </listOfSpeciesIndices>
                </speciesReference>
            </listOfReactants>
            <listOfProducts>
                <speciesReference species= "s2"/>
                    <listOfSpeciesIndices>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> x </ci>
                        </math>
                    </listOfSpeciesIndices>
                </speciesReference>
             </listofProducts>
            <kineticLaw>
                <note>
                    <p xmlns="http://www.w3.org/1999/xhtml">s1[x] * 0.1</p>
                </note>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <apply>
                        <times/>
                        <apply>
                            <selector>
                            <ci> s1 </ci>
                            <ci> x </ci>
                        </apply>
                        <cn> 0.1 </cn>
                    </apply>
                </math>
            <kineticLaw>
        </reaction>
    </listOfReactions>
</model>
\end{example}

\subsubsection{Use of \texttt{csymbol} for accessing high dimensional arrays}

Unfortunately MathML is not designed to represent matrices with more than 2 dimensions.
So that it is possible to access elements of arrays with more than 3 dimensions we
define a new URI, \texttt{http://www.sbml.org/symbols/selector}, for use with the MathML \texttt{csymbol} element
to define a selector operator that takes an arbitrary number of arguments.
This operator can be used in place of a the \texttt{selector} element.

\subsubsection{issue}

Do we want to support these two operators simultaneously? 

\section{Simplified Array Structures for Related Objects}

It is possible to incorporate a simplified mechanism for creating
species, compartment, rule and parameter arrays and for referencing the
elements of those arrays.

\subsection{Implied Species Arrays}
\label{sec:impliedarrays}

In this proposal when the \texttt{compartment} field of a
\texttt{Species} structure contains the identifier of an array of
compartments the \attrib{containerIndex} field (\texttt{listOfContainerIndices} element) can be omitted.
A structure configured in this fashion
represents an array of species with the same specification as the
given compartment array.  Each element of the species array is
located in a corresponding compartment element.  The species array
is not explicitly declared i.e. the \attrib{dimension} field (\texttt{listOfDimensions} element)
has alternative semantics.  For the moment in our examples it is omitted as well.

For example given
\begin{example}
<compartment id="cell">
    <listOfDimensions>
         <dimension id="x">
             <lowerLimit>
                 <math xmlns="http://www.w3.org/1998/Math/MathML">
                     <cn> 0 </cn>
                 </math>
             </lowerLimit>
             <upperLimit>
                 <math xmlns="http://www.w3.org/1998/Math/MathML">
                     <cn> 9 </cn>
                 </math>
             </upperLimit>
         </dimension>
    </listOfDimensions>
</compartment>
\end{example}
the structure
\begin{example}
<species id="s" compartment="cell" initialAmount="0">
    <listOfDimensions>
        <dimension id="x">
            <lowerLimit>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <cn> 0 </cn>
                </math>
            <lowerLimit>
            <upperLimit>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <cn> 9 </cn>
                </math>
            <upperLimit>
        </dimension>
    </listOfDimensions>
    <listOfContainerIndices>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <ci> x </ci>
        </math>
    </listOfContainerIndices>
</species>
\end{example}
can be replaced with the equivalent structure:
\begin{example}
<species id="s" compartment="cell" initialAmount="0"/>
\end{example}

If the species \texttt{dimension} field (\texttt{listOfDimensions} sub-element) is present but
the \attrib{containerIndex} field (\texttt{listOfContainerIndices} sub-element)is not present
the resulting species array created has the combined dimensions
of the compartment array and the dimensions enclosed in the \texttt{dimension} field.
The compartment dimensions are implied in the sequence before the species dimensions.
For example the following structure defines a 2
dimension array of species where the first dimension is mapped across a row of compartments:
\begin{example}
<compartment id="cell"/>
    <listOfDimensions>
        <dimension id="x">
            <lowerLimit>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <cn> 0 </cn>
                </math>
            </lowerLimit>
            <upperLimit>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <cn> 9 </cn>
                </math>
            </upperLimit>
        </dimension>
    </listOfDimensions>
</compartment>
...
<species id="ss" compartment="cell" initialAmount="0"/>
    <listOfDimensions>
        <dimension id="y">
            <lowerLimit>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <cn> 0 </cn>
                </math>
            </lowerLimit>
            <upperLimit>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <cn> 5 </cn>
                </math>
            </upperLimit>
        </dimension>
    </listOfDimensions>
</species>
\end{example}

On a species element which omits the \attrib{containerIndex} field (\texttt{listOfContainerIndices} sub-element)
then the symbols declared in the referenced compartment's \attrib{dimension} field (\texttt{listOfDimensions} sub-element)
are in scope in all the MathML expressions contained within the species structure.  For example a species structure
could omit the \attrib{containerIndex} field yet still use symbols from the compartment's \attrib{dimension} field
in the species' \attrib{elementExists} field (see section~\ref{sec:sparse} for more details on this field).

\subsection{Implied Compartment Arrays}

In SBML Level 2 it is possible to specify nested compartments.
For example the fragment:

\begin{example}
<listOfCompartments>
    <compartment id="a">
    <compartment id="b" outside="a">
</listOfCompartments>
\end{example}

Defines a compartment \texttt{b} which is enclosed by \texttt{a}.

The scheme used for species in the previous section can be applied in this case.
For example

\begin{example}
<listOfCompartments>
    <compartment id="a">
        <listOfDimensions>
            <dimension id="x">
                <lowerLimit>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <cn> 0 </cn>
                    </math>
                </lowerLimit>
                <upperLimit>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <cn> 5 </cn>
                    </math>
                </upperLimit>
            </dimension>
        </listOfDimensions>
    </compartment>
    <compartment id="b" outside="a"/>
</listOfCompartments>
\end{example}

is equivalent to

\begin{example}
<listOfCompartments>
    <compartment id="a"/>
        <listOfDimensions>
            <dimension id="x">
                <lowerLimit>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <cn> 0 </cn>
                    </math>
                </lowerLimit>
                <upperLimit>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <cn> 5 </cn>
                    </math>
                </upperLimit>
            </dimension>
        </listOfDimensions>
    </compartment>
    <compartment id="b" outside="a"/>
        <listOfDimensions>
            <dimension id="x">
                <lowerLimit>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <cn> 0 </cn>
                    </math>
                </lowerLimit>
                <upperLimit>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <cn> 5 </cn>
                    </math>
                </upperLimit>
            </dimension>
        </listOfDimensions>
        <listOfContainerIndices>
            <math xmlns="http://www.w3.org/1998/Math/MathML">
                <ci> x </ci>
            </math>
        </listOfContainerIndices>
    </compartment>
</listOfCompartments>
\end{example}

Similar scoping rules for symbols apply here as they do for species structures.

\subsection{Implied Parameter Arrays}

We can apply the above concept to parameters if we introduce a
new \texttt{SId} field, \texttt{foreach}, to the parameter
structure. This field allows us to reference any other symbol
from this structure and thus attach a parameter to each element
of the referenced array.

For example given:
\begin{example}
<compartment id="cell">
    <listOfDimensions>
        <dimension id="x">
            <lowerLimit>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <cn> 0 </cn>
                </math>
            </lowerLimit>
            <upperLimit>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <cn> 5 </cn>
                </math>
            </upperLimit>
        </dimension>
    </listOfDimensions>
</compartment>
...
\end{example}
then
\begin{example}
<parameter id="p" foreach="cell" value="0"/>
\end{example}
is equivalent to
\begin{example}
<parameter id="p" value="0">
    <listOfDimensions>
        <dimension id="x">
            <lowerLimit>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <cn> 0 </cn>
                </math>
            </lowerLimit>
            <upperLimit>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <cn> 5 </cn>
                </math>
            </upperLimit>
        </dimension>
    </listOfDimensions>
</parameter>
\end{example}

Similar scoping rules for symbols apply here as they do for species structures.

\section{Arrays of Assignment Rules}

Declaring arrays of assignment rules is slightly different from other component types.
Rule structures don't contain a \texttt{id}
field that declares a new symbol instead they reference another
structure via the \texttt{variable} field.  The
expressions contained in the \attrib{dimension} field
(\texttt{listOfDimensions} sub-element) operate in the same way as described above except
that the assignment rule array cells constrain corresponding cells with same indices
in the array referenced by the \texttt{variable} field.
For example the following model has a rule applied to an array of species.

\begin{example}
<model id="rules">
    <listOfCompartments>
        <compartment id="cell"/>
    </listOfCompartments>
    <listOfSpecies>
        <species id="s" initialAmount="0.1" compartment="cell">
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
        </species>
    </listOfSpecies>
    <listOfRules>
        <assignmentRule variable="s" type="rate">
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
            <math xmlns="http://www.w3.org/1998/Math/MathML">
                <cn> 0.1 </cn>
            </math>
        </assignmentRule>
    </listOfRules>
</model>
\end{example}

\subsection{Implied Arrays of Rules}

If the the \attrib{dimension} field
(\texttt{listOfDimensions} sub-element) is omitted and if the variable reference by the
assignment rule is an array then the assignment rule implicitly consists of an array with the
same dimensions as the reference variable object.  For example the previous example is equivalent to:

\begin{example}
<model id="rules">
    <listOfCompartments>
        <compartment id="cell"/>
    </listOfCompartments>
    <listOfSpecies>
        <species id="s" initialAmount="0.1" compartment="cell">
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
        </species>
    </listOfSpecies>
    <listOfRules>
        <assignmentRule variable="s" type="rate">
            <math xmlns="http://www.w3.org/1998/Math/MathML">
                <cn> 0.1 </cn>
            </math>
        </assignmentRule>
    </listOfRules>
</model>
\end{example}

As rules do not declare symbols it is possible for more than one
rule to be applied to the same array. For example consider the
following example:

\begin{example}
<model id="rules">
    <listOfCompartments>
        <compartment id="cell"/>
    </listOfCompartments>
    <listOfSpecies>
        <species id="s" initialAmount="0.1" compartment="cell">
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
        </species>
    </listOfSpecies>
    <listOfRules>
        <assignmentRule variable="s" type="rate">
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 4 </cn>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
            <math xmlns="http://www.w3.org/1998/Math/MathML">
                <cn> 0.1 </cn>
            </math>
        </assignmentRule>
        <assignmentRule variable="s" type="rate">
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 5 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
            <math xmlns="http://www.w3.org/1998/Math/MathML">
                <cn> 0.2 </cn>
            </math>
        </assignmentRule>
    </listOfRules>
</model>
\end{example}

\subsection{Rules which supply a matrix result}

Assignment Rules can be defined which apply to the whole of an array, or
slices of arrays, in which the formula expression returns a whole
array value rather than a single value to be inserted into each
array element.  This type of rule is indicated by the \texttt{matrixResult}
attribute having a \texttt{true} value (default is \texttt{false}).
The resulting array should have the same dimensions as the assignment variable
for which it is declared.  The result of the expression is then mapped onto
the array referenced in the rules \attrib{variable} field.
This type of rule must not have a any dimension

Whole matrix operators are described in
more detail in section~\ref{sec:math}.  For now assume that we
can, for instance, multiply arrays then consider the example
model:

\begin{example}
<model id="rules">
    <listOfCompartments>
        <compartment id="cell"/>
    </listOfCompartments>
    <listOfSpecies>
        <species id="s1" initialAmount="0.1" compartment="cell">
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    <lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    <upperLimit>
                </dimension>
            </listOfDimensions>
        </species>
        <species id="s2" initialAmount="0.2" compartment="cell">
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    <lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    <upperLimit>
                </dimension>
            </listOfDimensions>
        </species>
    </listOfSpecies>
    <listOfRules>
        <assignmentRule matrixResult="true" variable="s1" type="rate"/>
            <math xmlns="http://www.w3.org/1998/Math/MathML">
                <apply>
                    <plus/>
                    <ci> s1 </ci>
                    <ci> s2 </ci>
                </apply>
            </math>
        </assignmentRule>
    </listOfRules>
</model>
\end{example}

The rule for \texttt{s1} defines that the rate of change of the
values of the array of \texttt{s1} is the product of the concentration vectors
\texttt{s1} and \texttt{s2}.

\section{Sparse Arrays and Connections}

\subsection{Sparse Arrays}

In practice arrays are not very useful for modelling unless its
possible to describe connection schemes between elements of the
arrays.  For example if one creates a model of a tissue of cells
as an array of compartments then the model doesn't become
interesting until the interactions between the cells are
incorporated.  This section begins the process of proposing
structures which allow interconnection schemes to be defined.

In this proposal the structures \texttt{Species},
\texttt{Compartment}, \texttt{Reaction} etc. include an additional \texttt{elementExists}
MathML field.  This field should only occur when the structure is
declared as an array.  \texttt{elementExists} contains a constant
expression which defines whether an array element actually occurs
at a given position in the array.  This expression is
conditional, which means that a false value implies that
the element won't occur and a true value implies that
an element will occur.

The default value of \texttt{elementExists}, true, ensures that by
default the shape of the array specification is determined just
by the \attrib{dimension} field (\texttt{listOfDimensions} sub-element) alone.

Apart from the \texttt{elementExists} field, the set of dimension
symbols only have values for those elements that exist in the
array in which they are declared.

The index operand to an array operator must refer to an element
which exists in the array.  This means that the index must be a
value to which the \texttt{elementExists} expression returns a
true value.

\subsubsection{Issue}

To enable dynamic structures in SBML we could allow the
\texttt{elementExists} expression to be dynamic. This would allow
the model to change dynamically during the simulation.  Perhaps
other more explicit dynamic restructuring of a model should be
considered in SBML.
In fact we could generalise the concept of \attrib{elementExists} 
(perhaps renaming the field \attrib{exists}) so that it operates 
even when the given structure is not an array.  In this way a model 
could change dynamically during a simulation.

\subsection{Sparse Array Example}
\label{sec:sparseeg}

The following example shows a proposed structure for triangular
arrays where the maximum \texttt{y} index is equal to the
\texttt{x} index.

\begin{example}
<model id="starfish">
    <listOfCompartments>
        <compartment id="cell">
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
                <dimension id="y">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
            <elementExists>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <apply>
                        <leq/>
                        <ci> x </ci>
                        <ci> y </ci>
                    </apply>
                </math>
            </elementExists>
        </compartment>
    </listOfCompartments>
</model>
\end{example}

This can be defined in an alternative fashion by using the \texttt{x} symbol to define the bounds of the \texttt{y} dimension:
\begin{example}
<model id="starfish">
    <listOfCompartments>
        <compartment id="cell">
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
                <dimension id="y">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> x </ci>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
        </compartment>
    </listOfCompartments>
</model>
\end{example}

The index operand to an \texttt{selector} operator must refer to an element
which exists in an array.  

\subsection{Using Sparse Arrays to Represent Connection schemes}
\label{sec:connections}

We can use a proposed sparse array feature to represent the connections
between elements of another array.  If we have a $n$dimensional array of
components we can represent connections between those components as a $2 n$ dimensional 
sparse array.  In the sparse array elements only occur where connections are to be modelled.
Thus components that exist as connections are thus defined as sparse $2 n$ dimensional arrays.

This is shown in the
following example, in which \texttt{grid} is a 2 dimensional
array of compartments, \texttt{s} is a 2 dimensional array of
species distributed over the \texttt{grid}compartments and, \texttt{connections} is a sparse 4
dimensional array of reactions between elements of \texttt{s}.
\texttt{connections} contains array elements for all
pairs of co-ordinates where the co-ordinates are exactly one array element
away from each other.

\begin{example}
<model id="tissue">
    <listOfCompartments>
        <compartment id="grid"/>
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
                <dimension id="y">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
        </compartment>
    </listOfCompartments>
    <listOfSpecies>
        <species id="s" initialAmount="0.1" compartment="grid">
    </listOfSpecies>
    <listOfReactions>
        <reaction id="connections">
            <listOfDimensions>
                <dimension id="x1">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
                <dimension id="y1">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    <lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> 9 </ci>
                        </math>
                    </upperLimit>
                </dimension>
                <dimension id="x2">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    <lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 9 </cn>
                        </math>
                    </upperLimit>
                </dimension>
                <dimension id="y2">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> 9 </ci>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
            <elementExists>
                <note>
                    <p xmlns="http://www.w3.org/1999/xhtml">abs(x2 - x1) == 1 || abs(y2 - y1) == 1</p>
                </note>                
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <apply>
                        <or/>
                        <apply>
                            <eq/>
                            <apply/>
                                <abs/>
                                <apply>
                                    <minus/>
                                    <ci> x2 </ci>
                                    <ci> x1 </ci>
                                </apply>
                            </apply>
                            <cn> 1 </cn>
                        </apply>
                        <apply>
                            <eq/>
                            <apply/>
                                <abs/>
                                <apply>
                                    <minus/>
                                    <ci> y2 </ci>
                                    <ci> y1 </ci>
                                </apply>
                            </apply>
                            <cn> 1 </cn>
                        </apply>
                    </apply>
                </math>
            </elementExists>
            <listOfReactants>
                <speciesReference species= "s">
                    <listOfSpeciesIndices>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> x1 </ci>
                        </math>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> y1 </ci>
                        </math>
                    </listOfSpeciesIndices>
                </speciesReference>
            </listOfReactants>
            <listOfProducts>
                <speciesReference species= "s"/>
                    <listOfSpeciesIndices>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> x2 </ci>
                        </math>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> y2 </ci>
                        </math>
                    </listOfSpeciesIndices>
                </speciesReference>
            </listOfProducts>
            <kineticLaw>
                <note>
                    <p xmlns="http://www.w3.org/1999/xhtml">s[x1][y1] * 0.1"</p>
                </note>                
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <apply>
                        <times/>
                        <apply>
                            <selector/>
                            <ci> s </ci>
                            <ci> x1 </ci>
                            <ci> y1 </ci>
                        </apply>
                        <cn> 0.1 </cn>                            
                    </apply>
                </math>
            </kineticLaw
        </reaction>
    </listOfReactions>
</model>
\end{example}

The \texttt{connections} specification is bidirectional: for every
pair of adjacent \texttt{grid} co-ordinates there are a pair of
elements. \texttt{connections} can be simplified and made
unidirectional by changing the \texttt{elementExists} expression
to:
\begin{example}
x2 - x1 == 1 || y2 - y1 == 1
\end{example}
In this case the connections only run from bottom to top and left
to right.

\section{Array Math}
\label{sec:math}

Under this proposal the set of MathML elements that can be incorporated into SBML is extended 
to include the following:
\begin{itemize}
\item \emph{constructors} \texttt{matrix}, \texttt{matrixrow}, \texttt{vector}
\item \emph{element reference operator} \texttt{selector}
\item \emph{qualifier components} \texttt{bvar}, \texttt{lowlimit}, \texttt{uplimit}, \texttt{interval}, \texttt{condition}
\item \emph{linear algebra operators} \texttt{vectorproduct}, \texttt{scalarproduct}, \texttt{outerproduct}, \texttt{transpose}
\item \emph{sum product operators} \texttt{sum}, \texttt{product}
\item \emph{quantifier operators} \texttt{forall}, \texttt{exists}
\end{itemize}

Please refer to the MathML specification~\citep{w3c:2000b} for further details of the operation of these elements.

\section{Example: the community effect in developmental gene regulation}

This section contains an example model of the community effect in
developmental gene regulation~\citep{gurdon:1988}.  This model demonstrates how
the array proposal can be combined with the model composition proposal.

In the SBML given below the original model is broken into two parts the first SBML model
encodes the biochemical network inside each cell (this model doesn't use any array features).
The 2nd SBML model defines how this model is assembled into a tissue and uses the array features.

The original model basically contains a
high abstracted model of gene expression for a single gene as follows:

\begin{equation*}
  \begin{array}{@{}ccc@{}}
    ubiq & \underrightarrow{v_{mu} ubiq} & waste \\ \\[-4pt]
    mRNA & \underrightarrow{k_{dm} mRNA} & waste \\ \\[-4pt]
    p & \underrightarrow{k_{dp} p} & waste \\ \\[-4pt]
    mat & \underrightarrow{v_i} & ubiq \\ \\[-4pt]
    mat & \underrightarrow{\frac{k_t ubiq}{k_{mu} + ubiq}} & mRNA \\ \\[-4pt]
    mat & \underrightarrow{\frac{k_s mRNA}{k_{mu} + mRNA}} & p
  \end{array}
\end{equation*}

where $ubiq$ is a transcription factor, $p$ is the gene product,
$mat$ represents the material used to construct active species and
$waste$ represents the material produced by the degradation of
active species.  Both $mat$ and $waste$ are modelled as boundary
conditions.

This model is applied to a rectangular array of compartments. The
model contains a positive feedback loop between adjacent cells by
enabling the gene product of an adjacent cell to be a
transcription factor of the gene in the current cell. Thus the
feedback loop is completed by the following reaction for 

\begin{equation*}
  \begin{array}{@{}ccc@{}}
    mat_a & \underrightarrow{\frac{k_r p_tot}{k_mr + p_tot}} & mRNA_a
  \end{array}
\end{equation*}

where $p_tot$ is the total contribution of gene product from the cells
neighbors. These equations are encoded as reaction in the first model.
The $p$ and $p_tot$ species are the ports of the first model.

The second model simply creates an array of instances of the first model
and calculates the value of $p_tot$ for each cell.

The first model:
\begin{example}
<?xml version="1.0" encoding="UTF-8"?>
<sbml xmlns="http://www.sbml.org/sbml/level3" version="1" level="3">
<model id="cell_model">
    <listOfCompartments>
        <compartment id="cell"/>
    </listOfCompartments>
    <listOfSpecies>
        <species id="mat" compartment="cell_compartment" boundaryCondition="true" initialAmount="1.0"/>
        <species id="mRNA" compartment="cell_compartment" initialAmount="0"/>
        <species id="waste" compartment="cell" boundaryCondition="true" initialAmount="1.0"/>
        <species id="ubiq" compartment="cell" initialAmount="0"/>
        <species id="p" compartment="cell"/>
        <species id="pTot" compartment="cell"/>
    </listOfSpecies>
    <listOfParameters>
        <parameter id="kmu" value="0.1"/>
    </listOfParameters>
    <listOfReactions>
        <reaction id="ubiq2waste">
            <listOfReactants>
                <speciesReference species= "ubiq"/>
            </listOfReactants>
            <listOfProducts>
                <speciesReference species= "waste"/>
            </listOfProducts>
            <kineticLaw>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <apply>
                        <times/>
                        <ci> vmu </ci>
                        <ci> ubiq </ci>
                    </apply>
                </math>
                <listOfParameters>
                    <parameter id="vmu" value="0.1"/>
                </listOfParameters>
            </kineticLaw>
        </reaction>
        <reaction id="mRNA2waste">
            <listOfReactants>
                <speciesReference species= "mRNA"/>
            </listOfReactants>
            <listOfProducts>
                <speciesReference species= "waste"/>
            </listOfProducts>
            <kineticLaw>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <apply>
                        <times/>
                        <ci> kdm </ci>
                        <ci> mRNA </ci>
                    </apply>
                </math>
                <listOfParameters>
                    <parameter id="kdm" value="0.1"/>
                </listOfParameters>
            </kineticLaw>
        </reaction>
        <reaction id="p2waste">
            <listOfReactants>
                <speciesReference species= "p"/>
            </listOfReactants>
            <listOfProducts>
                <speciesReference species= "waste"/>
            </listOfProducts>
            <kineticLaw>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <apply>
                        <times/>
                        <ci> kdp </ci>
                        <ci> p </ci>
                    </apply>
                </math>
                <listOfParameters>
                    <parameter id="kdp" value="0.1"/>
                </listOfParameters>
            </kineticLaw>
        </reaction>
        <reaction id="mat2ubiq">
            <listOfReactants>
                <speciesReference species= "mat"/>
            </listOfReactants>
            <listOfProducts>
                <speciesReference species= "ubiq"/>
            </listOfProducts>
            <kineticLaw>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <ci> vi </ci>
                </math>
                <listOfParameters>
                    <parameter id="vi" value="0.1"/>
                </listOfParameters>
            </kineticLaw>
        </reaction>
        <reaction id="mat2p">
            <listOfReactants>
                <speciesReference species= "mat"/>
            </listOfReactants>
            <listOfProducts>
                <speciesReference species= "p"/>
            </listOfProducts>
            <listOfModifiers>
                <modifierSpeciesReference species="mRNA"/>
            </listOfModifiers>
            <kineticLaw>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <apply>
                        <divide/>
                        <apply>
                            <times/>
                            <ci>ks</ci>
                            <ci>mRNA</ci>    
                        </apply>
                        <apply>
                            <plus/>
                            <ci>kmu</ci>
                            <ci>mRNA</ci>
                        </apply>
                    </apply>
                </math>
                <listOfParameters>
                    <parameter id="ks" value="0.1"/>
                </listOfParameters>
            </kineticLaw>
        </reaction>
        <reaction id="local_mat2mRNA">
            <listOfReactants>
                <speciesReference species= "mat"/>
            </listOfReactants>
            <listOfProducts>
                <speciesReference species= "mRNA"/>
            </listOfProducts>
             <listOfModifiers>
                <modifierSpeciesReference species="ubiq"/>
            </listOfModifiers>
           <kineticLaw>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <apply>
                        <divide/>
                        <apply>
                            <times/>
                            <ci>kt</ci>
                            <ci>ubiq</ci>    
                        </apply>
                        <apply>
                            <plus/>
                            <ci>kmu</ci>
                            <ci>ubiq</ci>
                        </apply>
                    </apply>
                </math>
                <listOfParameters>
                    <parameter id="kt" value="0.1"/>
                </listOfParameters>
            </kineticLaw>
        </reaction>
        <reaction id="neighbour_mat2mRNA">
            <listOfReactants>
                <speciesReference species= "mat"/>
            </listOfReactants>
            <listOfProducts>
                <speciesReference species= "mRNA"/>
            </listOfProducts>
            <listOfModifiers>
                <modifierSpeciesReference species= "p"/>
            </listOfModifiers>
            <kineticLaw>
                <note>
                    <p xmlns="http://www.w3.org/1999/xhtml">(kr * pTot)/(kmr + pTot)</p>
                </note>
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <apply>
                        <divide/>
                        <apply>
                            <times/>
                            <ci>kr</ci>
                            <ci>pTot</ci>
                        </apply>    
                        <apply>
                            <add/>
                            <ci>kmr</ci>
                            <ci>pTot</ci>
                        </apply>    
                    </apply>
                </math>   
                <listOfParameters>
                    <parameter id="kr" value="0.1"/>
                    <parameter id="kmr" value="0.07"/>
                </listOfParameters>
            </kineticLaw>
        </reaction>
    </listOfReactions>
    <listOfPorts>
        <port object="pTot"/>
        <port object="p"/>
    </listOfPorts>
</model>
</sbml>
\end{example}

The second model:

\begin{example}
<?xml version="1.0" encoding="UTF-8"?>
<sbml xmlns="http://www.sbml.org/sbml/level3" version="1" level="3">
<model id="community_effect">
    <listOfIntegerParameters>
        <integerParameter id="xBound" value = "9"/>
        <integerParameter id="yBound" value = "5"/>
    </listOfIntegerParameters>
    <listOfCompartments>
        <compartment id="cell_compartment">
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> xBound </ci>
                        </math>
                    </upperLimit>
                </dimension>
                <dimension id="y">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> yBound </ci>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
        </compartment>
    </listOfCompartments>
    <listOfSpecies>
        <species id="p" compartment="cell_compartment" initialAmount="0"/>
        <species id="pTot" compartment="cell_compartment" initialAmount="0"/>
    </listOfSpecies>
    <listOfRules>
        <assignmentRule id="pTot">
            <math xmlns="http://www.w3.org/1998/Math/MathML">
                <apply>
                    <sum/>
                    <bvar><ci type="integer">xa</ci></bvar>
                    <interval><cn>0</cn><ci>xBound</ci></interval>
                    <apply>
                        <bvar><ci type="integer">ya</ci></bvar>
                        <interval><cn>0</cn><ci>yBound</ci></interval>
                        <condition>
                            <apply>
                                <and/>
                                <apply>
                                    <or/>
                                    <apply>
                                        <eq/>
                                        <ci> x </ci>
                                        <ci> xa </ci>
                                    </apply>
                                    <apply>
                                        <eq/>
                                        <ci> y </ci>
                                        <ci> ya </ci>
                                    </apply>
                                </apply>
                                <apply>
                                    <or/>
                                    <apply>
                                        <neq/>
                                        <ci> x </ci>
                                        <ci> xa </ci>
                                    </apply>
                                    <apply>
                                        <neq/>
                                        <ci> y </ci>
                                        <ci> ya </ci>
                                    </apply>
                                </apply>
                            </apply>
                        </condition>
                        <apply>
                            <selector/>
                            <ci>p</ci>
                            <ci>xa</ci>
                            <ci>xb</ci>
                        </apply>
                    </apply>
                </apply>
            </math>
        </assignmentRule>
    </listOfRules>
    <listOfInstances>
        <instance id="cell_instance" xlink:type="simple" xlink:href="cellModel.xml">
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> xBound </ci>
                        </math>
                    </upperLimit>
                </dimension>
                <dimension id="y">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> yBound </ci>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
        </instance>
    </listOfInstances>
    <listOfLinks>
        <link>
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> xBound </ci>
                        </math>
                    </upperLimit>
                </dimension>
                <dimension id="y">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> yBound </ci>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
            <from object="cell_compartment">
                <listOfObjectIndices>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <ci> x </ci>
                    </math>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <ci> y </ci>            
                    </math>
                </listOfObjectIndices>
            </from>
            <to object="cell_instance">
                <listOfObjectIndices>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <ci> x </ci>
                    </math>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <ci> y </ci>            
                    </math>
                </listOfObjectIndices>
                <subobject object="cell"/>
            </to>
        </link>
        <link>
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> xBound </ci>
                        </math>
                    </upperLimit>
                </dimension>
                <dimension id="y">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> yBound </ci>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
            <from object="p">
                <listOfObjectIndices>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <ci> x </ci>
                    </math>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <ci> y </ci>            
                    </math>
                </listOfObjectIndices>
            </from>
            <to object="cell_instance">
                <listOfObjectIndices>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <ci> x </ci>
                    </math>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <ci> y </ci>            
                    </math>
                </listOfObjectIndices>
                <subobject object="p"/>
            </to>
        </link>
        <link>
            <listOfDimensions>
                <dimension id="x">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> xBound </ci>
                        </math>
                    </upperLimit>
                </dimension>
                <dimension id="y">
                    <lowerLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <cn> 0 </cn>
                        </math>
                    </lowerLimit>
                    <upperLimit>
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <ci> yBound </ci>
                        </math>
                    </upperLimit>
                </dimension>
            </listOfDimensions>
            <from object="pTot">
                <listOfObjectIndices>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <ci> x </ci>
                    </math>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <ci> y </ci>            
                    </math>
                </listOfObjectIndices>
            </from>
            <to object="cell_instance">
                <listOfObjectIndices>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <ci> x </ci>
                    </math>
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <ci> y </ci>            
                    </math>
                </listOfObjectIndices>
                <subobject object="pTot"/>
            </to>
        </link>
    </listOfLinks>
</model>
</sbml>

\end{example}

\section{Acknowledgements}

Many thanks to Hamid Bolouri for suggesting the community effect model as an example model.

%-----------------------------------------------------------------------
%=============================================================================
% References
%=============================================================================

\bibliographystyle{apalike}
\bibliography{strings,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z}
\end{document}
