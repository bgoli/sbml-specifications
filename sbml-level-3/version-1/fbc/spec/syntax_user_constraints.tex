% -*- TeX-master: "main"; fill-column: 72 -*-

\newpage
\section{HARMONY: proposed extensions 2018}

\begin{quote}
 \textbf{\Large The contents of this section are, as yet, unofficial and are formulated here in order to optimize spec development effort.}
\end{quote}

The proposed \FBCPackage version~3 extends the definition of the \FluxObjective, extends the definition of the \token{chemicalFormula}, defines a \UserConstraint and adds a generic \KeyValuePair annotation.

\begin{figure}[ht!]
  \centering
  % Requires \usepackage{graphicx}
  \includegraphics[height=0.85\textheight]{images/fbc_uml_v3.pdf}\\
  \caption{A UML representation of the \FBCPackage version three. Derived from \SBase, most\FBC classes inherit support for constructs such as SBML \Notes and \Annotation's. The [association] element name is the name of the class, de-capitalized. In this case, the possible values are "and", "or", or "geneProductRef". See \ref{conventions} for conventions related to this figure. The individual classes are further discussed in the text.}
  \label{fig:fbc_uml_v3}
\end{figure}

%\subsection{The extended \class{SBase} class}
%\label{sbase-class-kv}

\subsection{The extended \class{Model} class}
\label{model-class-kv}
%\label{listoffluxbounds-class}

The \SBML \Model class is extended by a \token{listOfUserConstraints} of which it may contain at most one.
%
\begin{figure}[ht]
  \centering
  % Requires \usepackage{graphicx}
  %\includegraphics[width=6cm]{images/fbc_v3_uml_userconstraint.pdf}\\
  \includegraphics[width=\textwidth]{images/fbc_v3_uml_userconstraint.pdf}\\
  \caption{A UML representation of the \SBML \Model class extended in
  the \FBCPackage by the \ListOfUserConstraints. See \ref{conventions} for conventions related to this figure.}
  \label{fig:fbc_v3_uml_user_constraints}
\end{figure}

\subsubsection{Type \primtypeNC{FbcVariableType}}
\label{primtype-fbcvariabletype}

The \FBCPackage defines a new enumerated type \primtype{FbcVariableType} which
represents the index of a variable that occurs in either the \FluxObjective or \UserConstraintComponent. It has one of the following two values, \val{linear} or \val{quadratic}.


%\subsubsection{Type \primtypeNC{FbcUCCVariableType}}
%\label{primtype-fbcuserconstraintvariabletype}
%
%The \FBCPackage defines a new enumerated type \primtype{FbcUCCVariableType} which
%represents the index of a variable that occurs in a user defined constraint. It can have one
%of the following two values \val{linear} or \val{quadratic}.

\subsubsection{The \FBC \class{listOfUserConstraints}}
\label{listofuserconstraints-class}

As shown in \ref{fig:fbc_v3_uml_user_constraints} the \ListOfUserConstraints is derived from \SBase and inherits the attributes \token{metaid} and \token{sboTerm}, as well as
the subcomponents for \Annotation and \Notes. The \ListOfUserConstraints must contain at least one \UserConstraint (defined in \ref{userconstraint-class}).

\subsection{The extended \class{Species} class}

\paragraph{The \token{chemicalFormula} attribute}
\label{chemicalFormula-attribute}

The optional attribute \token{chemicalFormula} containing a \primtype{string} that represents the \Species objects elemental composition.
%
\exampleFile{examples/ex_spec_l3.txt}
%
\newtxt{While there are many ways of referring to an elemental composition, the purpose of the \token{chemicalFormula} attribute is to enable reaction balancing and validation, something of particular importance in constraint-based models.}

\newtxt{The format of the \token{chemicalFormula} should, whenever possible, consist only of atomic names
(as in the Periodic Table). Similarly, for enhanced inter-operability, the element order should be arranged according to the Hill system} \citep{hillsystem, hillwikipedia}.
%
\begin{table}[h!]
  \begin{tabular}{ccc}
    % after \\: \hline or \cline{col1-col2} \cline{col3-col4} ...
     $H_{2}O_{4}S$ & $C_{2}H_{5}Br$ & $BrH$ \\
     $C_{10}H_{12}N_{5}O_{13}P_{3}$ & $CH_{3}I$ & $CH_{4}$  \\
  \end{tabular}
  \caption{Examples of chemical formulas written using the Hill System. As
	described in \ref{chemicalFormula-attribute}}\label{table:hill}
\end{table}
%
\newtxt{Using this notation the number of carbon atoms in a molecule is indicated first, followed by the number of hydrogen atoms and then the number of all other chemical elements in alphabetical order. When the formula contains no carbon; all elements, including hydrogen, are listed alphabetically. Where there is more than a single atom present, this is indicated with an integer that precedes the element symbol.}

\newtxt{However, in certain situations it does become necessary to use a generic symbol in a user defined compound. For example, such symbols can include \token{R} and \token{X} and have the general form of a single capital letter followed by zero or more lowercase letters."}
%
\begin{table}[h!]
  \begin{tabular}{ccc}
    % after \\: \hline or \cline{col1-col2} \cline{col3-col4} ...
     $RCONH_{2}$ & $RCOX$ & $C_{2}H_{4}O_{2}(CH_{2})_{n}$ \\
  \end{tabular}
  \caption{Examples of chemical formulas written using allowed non-Hill symbols, as described in \ref{chemicalFormula-attribute}.}\label{table:non-hill}
\end{table}
%
\newtxt{In addition the undefined parenthesised group index may also occur: $(\ldots)_n$. While allowed, the use of any of these symbols is not encourage as, in general, any reaction in which such a \Species occurs as a reagent cannot be balanced. Therefore, any \token{chemicalFormula} that contains any of the aforementioned, non-Hill compatible symbols, will generate a `best practices' warning on model validation.}

\subsection{The \FBC \class{FluxObjective} class}

\paragraph{The \token{variableType} attribute}
The required \token{variableType} attribute contains a \primtype{FbcVariableType} that
represents the index of a variable that occurs in a \FluxObjective. It can have one
of the following two values \val{linear} or \val{quadratic}.
%
\exampleFile{examples/ex-v3-userconstraints.txt}
%
\begin{figure}[ht]
  \centering
  % Requires \usepackage{graphicx}
  \includegraphics[width=6cm]{images/fbc_v3_uml_fobj.pdf}\\
  \caption{A UML representation of the \FBCPackage \FluxObjective class. For a complete description see \ref{fig:fbc_uml} as well as \ref{conventions} for conventions related to this figure.}
  \label{fig:fbc_uml_userconstraint}
\end{figure}



\subsection{The \FBC \class{UserConstraint} class}
\label{userconstraint-class}

The \FBC \UserConstraint class is derived from \SBML \SBase and inherits
\token{metaid} and \token{sboTerm}, as well as the subcomponents for
\Annotation and \Notes. It's purpose is to define non-stoichiometric constraints, i.e., constraints that are not implicitly defined by the reaction network. The \UserConstraint contains a linear combination of \UserConstraintComponent's contained in a \ListOfUserConstraintComponents.

\paragraph{The \token{id} and \token{name} attributes}
A \UserConstraint has an optional \token{id} of type
\primtype{SId} and an optional attribute \token{name} of type \primtype{string}.

\paragraph{The \token{lowerBound} attribute}
The required \token{lowerBound} attribute contains an \primtype{SIdRef} that references a \Parameter which contains the lower boundary value of the \UserConstraint.

\paragraph{The \token{upperBound} attribute}
The required \token{upperBound} attribute contains an \primtype{SIdRef} that references a \Parameter which contains the upper boundary value of the \UserConstraint.

\paragraph{The \token{listOfUserConstraintComponents} element}
\label{listofuserconstraintcomponents-class}

The element \token{listOfUserConstraintComponents} which contains a
\ListOfUserConstraintComponents is derived from and functions like a typical \SBML
\textsf{\textbf{ListOf\rule{0.15in}{0.5pt}}} class with the restriction that it
must contain one or more elements of type \UserConstraintComponent (see \ref{userconstraintcomponent-class}).
This implies that if a \UserConstraint is defined there should be at least
one \UserConstraintComponent contained in a \ListOfUserConstraintComponents.

%\begin{figure}[ht]
%  \centering
%  % Requires \usepackage{graphicx}
%  %\includegraphics[width=5cm]{images/v2harmony_fbc_objective.pdf}\\
%  \caption{A UML representation of the \FBCPackage \UserConstraint class. For a complete description see \ref{fig:fbc_uml} as well as \ref{conventions} for conventions related to this figure.}
%  \label{fig:fbc_uml_userconstraint}
%\end{figure}

\subsection{The \FBC \class{UserConstraintComponent} class}
\label{userconstraintcomponent-class}

The \FBC \UserConstraintComponent class is derived from \SBML \SBase and inherits
\token{metaid} and \token{sboTerm}, as well as the subcomponents for
\Annotation and \Notes. The \UserConstraintComponent class is a relatively simple container for a variable and a variable type specifier which is weighted by a signed coefficient.

\paragraph{The \token{id} and \token{name} attributes}
An \UserConstraintComponent has an optional \token{id} of type \primtype{SId} and an optional attribute \token{name} of type \primtype{string}.

\paragraph{The \token{coefficient} attribute}
The required \token{coefficient} attribute contains an \primtype{SIdRef} that is restricted to reference only a \Parameter which then holds the coefficient value. (\newtxt{In strict mode this should probably behave like a FluxObjective coefficient and not be able to have the value NaN and +-inf }).

\paragraph{The \token{variable} attribute}
The required \token{variable} attribute contains an \primtype{SIdRef} that is restricted to reference the \primtype{SId} of either a \Reaction or (\newtxt{non-constant?}) \Parameter. \newtxt{If a \token{variable} refers to a \Parameter, it may not refer to the \primtype{SId} referenced by the \token{coefficient} attribute.}

\paragraph{The \token{variableType} attribute}
The required \token{variableType} attribute contains a \primtype{FbcVariableType} that indicates whether a variable should be considered as `linear' or `quadratic'.







\subsection{The \FBC \class{ListOfKeyValuePairs} class}
\label{listofkeyvaluepairs-class}

The \ListOfKeyValuePairs, see \ref{fig:fbc_v3_uml_keyvalue} for details, forms the basis of a controlled annotation defined by the \FBCPackage. This element defines a `structured note' or `descriptive list' of keys and associated values.
%
\exampleFile{examples/ex-v3-kvp1.txt}
%
%\begin{quote}
%\begin{description}
%  \item[keyX] 47
%  \item[ZZkey] beard level 5
%  \item[x--factor] intangible metaphysical property
%\end{description}
%\end{quote}
%%
As such it is analogous to the official \SBML RDF annotation used to support MIRIAM annotations, as defined in the \SBML specification documents. Similarly, we define an official \FBC annotation, the \ListOfKeyValuePairs. The advantages of using the existing \SBML annotation mechanism include, \SBase not needing any further extension (a technical/performance advantage) and the annotation can be used directly in all existing \SBML levels and versions.

As is the case with the RDF/MIRIAM annotations, support for \ListOfKeyValuePairs will be included in the \SBML support libraries.
%
\begin{figure}[ht]
  \centering
  % Requires \usepackage{graphicx}
  %\includegraphics[width=6cm]{images/fbc_v3_uml_keyvalue.pdf}\\
  \includegraphics[width=0.6\textwidth]{images/fbc_v3_uml_keyvalue.pdf}\\
  \caption{A UML representation of the \SBML \SBase class extended in
  the \FBCPackage by the \protect{\ListOfKeyValuePairs}. See \ref{conventions} for conventions related to this figure.}
  \label{fig:fbc_v3_uml_keyvalue}
\end{figure}
%
As shown in \ref{fig:fbc_v3_uml_keyvalue}, the \ListOfKeyValuePairs is derived from and functions like a typical \SBML \textsf{\textbf{ListOf\rule{0.15in}{0.5pt}}} class with the restriction that it must contain one or more elements of type \KeyValuePair (see \ref{keyvaluepair-class}). In addition it defines a single mandatory attribute, \token{xmlns}.

\paragraph{The \token{xmlns} attribute}
The \token{xmlns} is a mandatory component of the \ListOfKeyValuePairs, is of the type \primtype{url} which must have the value: \token{http://sbml.org/fbc/keyvaluepair}.


\subsection{The \FBC \class{KeyValuePair} class}
\label{keyvaluepair-class}

The \FBC \KeyValuePair class is not derived from \SBase and therefore \newtxt{does not} inherit \token{metaid} and \token{sboTerm}, as well as, the subcomponents for
\Annotation and \Notes. It's purpose is to define a key--value pair.

The \KeyValuePair defines a single mandatory attribute the \token{key} as well as two optional attributes: \token{value} and \token{url}.

\paragraph{The \token{key} attribute}
The \token{key} is the mandatory component of the \KeyValuePair pair and is of type \primtype{string}. It has the property that every \token{key} must be unique in the encapsulating \ListOfKeyValuePairs.

\paragraph{The \token{value} attribute}
The optional \token{value} attribute is of \primtype{string} and contains the value associated with a particular \token{key}. If not present, the \KeyValuePair is defined to have no value.

\paragraph{The \token{url} attribute}
The optional attribute \token{url} is of type \primtype{url}. This attribute is included and references a resource that contains a description of the \token{key} component of the \KeyValuePair. Note that the nature or structure of this resource is not defined. For example, it could be an HTML page with a textual description of the \token{key}(s) used by a particular tool or another that contains a table.




