% -*- TeX-master: "main"; fill-column: 72 -*-

\newpage
\section{HARMONY: proposed extensions 2018}

\begin{quote}
 \textbf{\Large The contents of this section are, as yet, unofficial and are formulated here in order to optimize spec development effort.}
\end{quote}

The proposed \FBCPackage version~3 extends the definition of the \FluxObjective, extends the definition of the \token{chemicalFormula}, defines a \UserConstraint and adds a generic \KeyValue annotation.

\begin{figure}[ht!]
  \centering
  % Requires \usepackage{graphicx}
  \includegraphics[height=0.85\textheight]{images/fbc_uml_v3.pdf}\\
  \caption{A UML representation of the \FBCPackage version three. Derived from \SBase, most
	\FBC classes inherit support for constructs such as SBML \Notes and
	\Annotation's. The [association] element name is the name of the class, de-capitalized.  In this case, the possible values are "and", "or", or "geneProductRef". See \ref{conventions} for conventions related to this figure.
	The individual classes are further discussed in the text.}
  \label{fig:fbc_uml}
\end{figure}


\subsection{The extended \class{SBase} class}
\label{sbase-class-kv}

The \SBML \SBase class is extended by a \token{listOfKeyValues}, of which it may contain at most one.
%
\begin{figure}[ht]
  \centering
  % Requires \usepackage{graphicx}
  %\includegraphics[width=6cm]{images/fbc_v3_uml_keyvalue.pdf}\\
  \includegraphics[width=0.6\textwidth]{images/fbc_v3_uml_keyvalue.pdf}\\
  \caption{A UML representation of the \SBML \SBase class extended in
  the \FBCPackage by the \ListOfKeyValues. See \ref{conventions} for conventions related to this
  figure.}
  \label{fig:fbc_v3_uml_keyvalue}
\end{figure}


\subsection{The extended \class{Model} class}
\label{model-class-kv}
%\label{listoffluxbounds-class}

The \SBML \Model class is extended by a \token{listOfUserConstraints} of which it may contain at most one.
%
\begin{figure}[ht]
  \centering
  % Requires \usepackage{graphicx}
  %\includegraphics[width=6cm]{images/fbc_v3_uml_userconstraint.pdf}\\
  \includegraphics[width=\textwidth]{images/fbc_v3_uml_userconstraint.pdf}\\
  \caption{A UML representation of the \SBML \Model class extended in
  the \FBCPackage by the\ListOfUserConstraints. See \ref{conventions} for conventions related to this
  figure.}
  \label{fig:fbc_v3_uml_user_constraints}
\end{figure}

\subsubsection{Type \primtypeNC{FbcVariableType}}
\label{primtype-fbcvariabletype}

The \FBCPackage defines a new enumerated type \primtype{FbcVariableType} which
represents the index of a variable that occurs in either the \FluxObjective or \UserConstraintComponent. It has one of the following two values, \val{linear} or \val{quadratic}.


%\subsubsection{Type \primtypeNC{FbcUCCVariableType}}
%\label{primtype-fbcuserconstraintvariabletype}
%
%The \FBCPackage defines a new enumerated type \primtype{FbcUCCVariableType} which
%represents the index of a variable that occurs in a user defined constraint. It can have one
%of the following two values \val{linear} or \val{quadratic}.


\subsection{The extended \class{Species} class}

\paragraph{The \token{chemicalFormula} attribute}
\label{chemicalFormula-attribute}

The optional attribute \token{chemicalFormula} containing a \primtype{string} that represents the \Species objects elemental composition.
%
\exampleFile{examples/ex_spec_l3.txt}
%
\newtxt{While there are many ways of referring to an elemental composition, the purpose of the \token{chemicalFormula} attribute is to enable reaction balancing and validation, something of particular importance in constraint-based models.}

\newtxt{The format of the \token{chemicalFormula} should, whenever possible, consist only of atomic names
(as in the Periodic Table). Similarly, for enhanced inter-operability, the element order should be arranged according to the Hill system} \citep{hillsystem, hillwikipedia}.
%
\begin{table}[h!]
  %\centering
  H2O4S\qquad C2H5Br\qquad BrH\\
  C10H12N5O13P3\qquad CH3I\\
  \caption{Examples of chemical formulas written using the Hill System. As
	described in \ref{chemicalFormula-attribute}}\label{table:hill}
\end{table}
%
\newtxt{Using this notation the number of carbon atoms in a molecule is indicated first, followed by the number of hydrogen atoms and then the number of all other chemical elements in alphabetical order. When the formula contains no carbon; all elements, including hydrogen, are listed alphabetically. Where there is more than a single atom present, this is indicated with an integer that precedes the element symbol.}

\newtxt{However, in certain situations it does become necessary to use a generic symbol in a user defined compound. For example, such symbols can include \token{R} and \token{X} and have the general form of a single capital letter followed by zero or more lowercase letters."}

\newtxt{In addition the undefined parenthesised group index may also occur: $(\ldots)_n$. While allowed, the use of any of these symbols is not encourage as, in general, any reaction in which such a \Species occurs as a reagent cannot be balanced. Therefore, any \token{chemicalFormula} that contains any of the aforementioned, non-Hill compatible symbols, will generate a `best practices' warning on model validation.}



\subsection{The \FBC \class{FluxObjective} class}

\paragraph{The \token{variableType} attribute}
The required \token{variableType} attribute contains a \primtype{FbcVariableType} that
represents the index of a variable that occurs in a \FluxObjective. It can have one
of the following two values \val{linear} or \val{quadratic}.
%
\begin{figure}[ht]
  \centering
  % Requires \usepackage{graphicx}
  \includegraphics[width=6cm]{images/fbc_v3_uml_fobj.pdf}\\
  \caption{A UML representation of the \FBCPackage \FluxObjective class. For a complete description see \ref{fig:fbc_uml} as well as \ref{conventions} for conventions related to this figure.}
  \label{fig:fbc_uml_userconstraint}
\end{figure}

\subsubsection{The \FBC \class{listOfUserConstraints}}
\label{listofuserconstraints-class}

As shown in \ref{fig:fbc_v3_uml_user_constraints} the \ListOfUserConstraints is derived from \SBase
and inherits the attributes \token{metaid} and \token{sboTerm}, as well as
the subcomponents for \Annotation and \Notes. The
\ListOfUserConstraints must contain at least one \UserConstraint (defined in
\ref{userconstraint-class}).

\subsection{The \FBC \class{UserConstraint} class}
\label{userconstraint-class}

The \FBC \UserConstraint class is derived from \SBML \SBase and inherits
\token{metaid} and \token{sboTerm}, as well as the subcomponents for
\Annotation and \Notes. It's purpose is to define non-stoichiometric constraints, i.e., constraints that are not implicitly defined by the reaction network. The \UserConstraint contains a linear combination of \UserConstraintComponent's contained in a \ListOfUserConstraintComponents.

\paragraph{The \token{id} and \token{name} attributes}
An \UserConstraint has an optional \token{id} of type
\primtype{SId} and an optional attribute \token{name} of type \primtype{string}.

\paragraph{The \token{lowerBound} attribute}
The required \token{lowerBound} attribute contains an \primtype{SIdRef} that references a \Parameter which contains the lower boundary value of the \UserConstraint.

\paragraph{The \token{upperBound} attribute}
The required \token{upperBound} attribute contains an \primtype{SIdRef} that references a \Parameter which contains the upper boundary value of the \UserConstraint.

\paragraph{The \token{listOfUserConstraintComponents} element}
\label{listofuserconstraintcomponents-class}

The element \token{listOfUserConstraintComponents} which contains a
\ListOfUserConstraintComponents is derived from and functions like a typical \SBML
\textsf{\textbf{ListOf\rule{0.15in}{0.5pt}}} class with the restriction that it
must contain one or more elements of type \UserConstraintComponent (see \ref{userconstraintcomponent-class}).
This implies that if a \UserConstraint is defined there should be at least
one \UserConstraintComponent contained in a \ListOfUserConstraintComponents.

%\begin{figure}[ht]
%  \centering
%  % Requires \usepackage{graphicx}
%  %\includegraphics[width=5cm]{images/v2harmony_fbc_objective.pdf}\\
%  \caption{A UML representation of the \FBCPackage \UserConstraint class. For a complete description see \ref{fig:fbc_uml} as well as \ref{conventions} for conventions related to this figure.}
%  \label{fig:fbc_uml_userconstraint}
%\end{figure}

\subsection{The \FBC \class{UserConstraintComponent} class}
\label{userconstraintcomponent-class}

The \FBC \UserConstraintComponent class is derived from \SBML \SBase and inherits
\token{metaid} and \token{sboTerm}, as well as the subcomponents for
\Annotation and \Notes. The \UserConstraintComponent class is a relatively simple container for a variable and a variable type specifier which is weighted by a signed coefficient.

\paragraph{The \token{id} and \token{name} attributes}
An \UserConstraintComponent has an optional \token{id} of type \primtype{SId} and an optional attribute \token{name} of type \primtype{string}.

\paragraph{The \token{coefficient} attribute}
The required \token{coefficient} attribute contains an \primtype{SIdRef} that is restricted to reference only a \Parameter which then holds the coefficient value. (\newtxt{In strict mode this should probably behave like a FluxObjective coefficient and not be able to have the value NaN and +-inf }).

\paragraph{The \token{variable} attribute}
The required \token{variable} attribute contains an \primtype{SIdRef} that is restricted to reference the \primtype{SId} of either a \Reaction or (\newtxt{non-constant?}) \Parameter.

\paragraph{The \token{variableType} attribute}
The required \token{variableType} attribute contains a \primtype{FbcVariableType} that indicates whether a variable should be considered as `linear' or `quadratic'.

\subsubsection{The \FBC \class{listOfKeyValues}}
\label{listofkeyvalues-class}
As shown in \ref{fig:fbc_v3_uml_keyvalue} the \ListOfKeyValues extends \SBase and defines the \token{listOfKeyValues}. It \newtxt{does not} inherit the
attributes \token{metaid} and \token{sboTerm}, as well as the subcomponents for \Annotation and \Notes. The \ListOfKeyValues contains \KeyValue's (defined in \ref{keyvalue-class}).

\subsection{The \FBC \class{KeyValue} class}
\label{keyvalue-class}

\newtxt{Frank notes that a ListOfKeyValues is ambigous and that KeyValue's should go back to KeyValuePairs. I tend to agree.}

The \FBC \KeyValue class is not derived from \SBML \SBase and \newtxt{does not} inherit
\token{metaid} and \token{sboTerm}, as well as the subcomponents for
\Annotation and \Notes. It's purpose is to define a tuple containing a
structured key--value pair.

%\paragraph{The \token{id} and \token{name} attributes}
%An \UserConstraint has an optional \token{id} of type
%\primtype{SId} and an optional attribute \token{name} of type \primtype{string}.


\newtxt{Sarah notes that the introduction of url can create precedence and validation issues. I need to look into this and, in general, expand the KVP text a lot.}

\paragraph{The \token{key} attribute}
The \token{key} is the only mandatory component of the \KeyValue pair and is of type \primtype{string}.

\paragraph{The \token{url} attribute}
The optional attribute \token{url} is of type \primtype{url} and is designed to point to a resource that defines (or describes) the aforementioned \token{key} attribute.

\paragraph{The \token{value} attribute}
The optional \token{value} attribute is of \primtype{string} and contains the value referred to by the key. Note, when the \token{url} attribute is used the triple must refer to the same thing.


