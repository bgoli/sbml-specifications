\newcounter{arraysCtr}
\newcommand{\printValid}{\validRule{arrays-\arabic{arraysCtr}\addtocounter{arraysCtr}{1}}}
\section{Validation Rules}
\label{validation}

This section summarizes all the conditions that must (or in some cases,
at least \emph{should}) be true of an SBML Level~3 Version~1 model that
uses the Arrays package.  We use the same
conventions as are used in the SBML Level~3 Version~1 Core specification
document.  In particular, there are different degrees of rule
strictness.  Formally, the differences are expressed in the statement of
a rule: either a rule states that a condition \emph{must} be true, or a
rule states that it \emph{should} be true.  Rules of the former kind are
strict SBML validation rules---a model encoded in SBML must conform to
all of them in order to be considered valid.  Rules of the latter kind
are consistency rules.  To help highlight these differences, we use the
following three symbols next to the rule numbers:

\begin{description}

\item[\hspace*{6.5pt}\vSymbol\vsp] A \vSymbolName indicates a
  \emph{requirement} for SBML conformance. If a model does not follow
  this rule, it does not conform to the Arrays
  specification.  (Mnemonic intention behind the choice of symbol:
  ``This must be checked.'')

\item[\hspace*{6.5pt}\cSymbol\csp] A \cSymbolName indicates a
  \emph{recommendation} for model consistency.  If a model does not
  follow this rule, it is not considered strictly invalid as far as the
  Arrays specification is concerned; however, it
  indicates that the model contains a physical or conceptual
  inconsistency.  (Mnemonic intention behind the choice of symbol:
  ``This is a cause for warning.'')

\item[\hspace*{6.5pt}\mSymbol\msp] A \mSymbolName indicates a strong
  recommendation for good modeling practice.  This rule is not strictly
  a matter of SBML encoding, but the recommendation comes from logical
  reasoning.  As in the previous case, if a model does not follow this
  rule, it is not considered an invalid SBML encoding.  (Mnemonic
  intention behind the choice of symbol: ``You're a star if you heed
  this.'')

\end{description}

The validation rules listed in the following subsections are all stated
or implied in the rest of this specification document.  They are
enumerated here for convenience.  Unless explicitly stated, all
validation rules concern objects and attributes specifically defined in
the Arrays package.

For \notice convenience and brievity, we use the shorthand
``\token{arrays:x}'' to stand for an attribute or element name \token{x}
in the namespace for the Arrays package, using
the namespace prefix \token{comp}.  In reality, the prefix string may be
different from the literal ``\token{arrays}'' used here (and indeed, it
can be any valid XML namespace prefix that the modeler or software
chooses).  We use ``\token{arrays:x}'' because it is shorter than to
write a full explanation everywhere we refer to an attribute or element
in the Arrays package namespace.

\subsubsection*{General rules about the Arrays package}
\setcounter{arraysCtr}{10101} 
\printValid{To conform to Version 1 of the Arrays package
  specification for SBML Level~3, an SBML document must declare the
  use of the following XML Namespace: \\ \textls[-25]{\uri{http://www.sbml.org/sbml/level3/version1/arrays/version1}}. (Reference:
  SBML Level~3 Package Specification for Arrays, Version~1, \sec{xml-namespace}.)}
  
\printValid{Wherever they appear in an SBML document,
  elements and attributes from the Arrays
  package must be declared either implicitly or explicitly to be in the
  XML namespace
     \\ \textls[-25]{\uri{http://www.sbml.org/sbml/level3/version1/arrays/version1}}.
  (Reference: SBML Level~3 Package Specification for Arrays,
  Version~1, \sec{xml-namespace}.) }

\subsubsection*{Rules for the extended \class{SBML} class} 
\setcounter{arraysCtr}{10201}

\printValid{In all SBML documents using the Arrays package, the \SBML object must include a value for
  the attribute \token{arrays:required} attribute.  (Reference: SBML Level~3 Version~1 Core, Section~4.1.2.)}
  
\printValid{The value of attribute \token{arrays:required} on
  the \SBML object must be of the data type \token{boolean}.
  (Reference: SBML Level~3 Version~1 Core, Section~4.1.2.) }
  
\printValid{The value of attribute \token{arrays:required} on
  the \SBML object must be set to \val{true} (Reference: \sbmlthreearrays, \sec{xml-namespace}.) }
 
\subsubsection*{General rules about MathML content in the Arrays Package} 

\printValid{Wherever MathML content appears in an SBML document, the MathML
content must be placed within a math element, and that math element
must be either explicitly or implicitly declared to be in the XML
namespace   \textls[-25]{\uri {http://www.w3.org/1998/Math/MathML‚Äù}}.
 (Reference: SBML Level~3 Version~1 Core, Section~3.4.)}

\printValid{The following is a list of the additional MathML 2.0 elements
  permitted in the Arrays package:  \token{vector},
  \token{selector}, \token{lowlimit}, \token{uplimit}
  \token{condition}, \token{sum}, \token{product},\token{forall},
  \token{exists}, \token{mean}, \token{sdev}, \token{variance},
  \token{median}, \token{mode}, \token{moment}, and \token{momentabout}.
  (Reference: SBML Level~3 Package Specification for Arrays,
  Version~1, \sec{math-formulas}.) }

\printValid{The arguments of a MathML \token{vector} must all have the same number of dimensions and agree in their size. (Reference: SBML Level~3 Package Specification for Arrays,
  Version~1, \sec{math-formulas}.)}

\printValid{The first argument of a MathML \token{selector} must be a MathML \token{vector} object or a valid identifier to an \SBase object extended with a list of \Dimension objects. (Reference: SBML Level~3 Package Specification for Arrays,
  Version~1, \sec{math-formulas}.)}

\printValid{The arguments of a MathML \token{selector} other than the first argument must evaluate to non-negative integers, and they must be statically computable.  In other words, any identifier that appears in an argument, other than a \Dimension \primtype{id} for the corresponding object, must be a constant. (Reference: SBML Level~3 Package Specification for Arrays, Version~1, \sec{math-formulas}.)}

%% QUESTION: Is this a validation rule?
% \printValid{For MathML unary operations involving a MathML \token{vector} or an \SBase object with a list of \Dimension objects, the operator is performed element-wise on each entry of the array.}

%% QUESTION: Is this a validation rule?
% \printValid{For MathML operations with two or more operands involving a MathML \token{vector} or an \SBase object with a list of \Dimension objects, the operand is performed element-wise.}

\printValid{For MathML operations with two or more operands involving MathML \token{vectors} or \SBase objects with a list of \Dimension objects, the number of dimensions and their size must agree for all operands unless the operand is a scalar type (i.e., it does not have a list of \Dimension objects). (Reference: SBML Level~3 Package Specification for Arrays,
  Version~1, \sec{math-formulas}.)}

\subsubsection*{Rules for the extended \class{SBase} abstract class} 
\setcounter{arraysCtr}{20101} 
\printValid{Any object derived from the extended \SBase class
  (defined in the Arrays package) may contain
  at most one instance of a \ListOfDimensions.
  (Reference: SBML Level~3 Package Specification for Arrays, Version~1, \sect{sec:dimension}.) }

\printValid{Apart from the general notes and annotation
  permitted on all SBML objects, a \ListOfDimensions
  container object may only contain \Dimension objects.
  (Reference: SBML Level~3 Package Specification for Arrays,
  Version~1, \sec{sec:dimension}.) }

\printValid{The \ListOfDimensions associated with an \SBase object must have a
    \Dimension object with \token{arrays:arrayDimension} attribute set
    to 0 before adding a  \Dimension object with \token{arrays:arrayDimension} attribute set
    to 1. Similarly, the \ListOfDimensions in an \SBase object must have
    \Dimension objects, where one of them has \token{arrays:arrayDimension} attribute set
    to 0 and the other set to 1 before adding a  \Dimension object with  \token{arrays:arrayDimension} attribute set
    to 2. (Reference:
  \sbmlthreearrays, \sec{sec:dimension}.) }

\printValid{The \ListOfDimensions associated with an \SBase object must not have multiple
    \Dimension objects with the same \token{arrays:arrayDimension} attribute. (Reference:
  \sbmlthreearrays, \sec{sec:dimension}.) }

\printValid{A \ListOfDimensions object may have the optional SBML core attributes \token{metaid} and \token{sboTerm}.  No other attributes from the SBML Level~3 Core namespace or the Arrays namespace are permitted on a \ListOfDimensions object.  (Reference: \sbmlthreearrays, \sec{sec:dimension}.) }

\printValid{No \token{ListOf} objects are not permitted to have a \ListOfDimensions. (Reference: \sbmlthreearrays, \sec{sec:dimensionUsage}.)}

\printValid{In SBML Level~3 Core, \token{Models}, \token{FunctionDefinitions}, \token{Units}, \token{UnitDefinitions}, \token{KineticLaws}, \token{LocalParameters}, \token{Triggers}, \token{Priorities}, and \token{Delays} are not permitted to have a \ListOfDimensions.  All other SBML Level~3 Core objects are permitted to have a \ListOfDimensions including:
\token{Compartments},
\token{Species},
\token{Parameters},
\token{Initial assignments},
\token{Rules},
\token{Constraints},
\token{Reactions},
\token{Species references},
\token{Events}, and
\token{Event assignments}.  All SBML objects defined by packages that inherit from \SBase are permitted to have a \ListOfDimensions unless it is explicitly disallowed in the corresponding package specification. 
(Reference: \sbmlthreearrays, \sec{sec:dimensionUsage}.)}

\printValid{Any object derived from the extended \SBase class
  (defined in the Arrays package) may contain
  at most one instance of a \ListOfIndices.
  (Reference: SBML Level~3 Package Specification for Arrays, Version~1, \sect{sec:index}.) }

\printValid{Apart from the general notes and annotation
  subobjects permitted on all SBML objects, a \ListOfIndices
  container object may only contain \Index objects.
  (Reference: SBML Level~3 Package Specification for Arrays,
  Version~1, \sec{sec:index}.) }

\printValid{The \ListOfIndices associated with an \SBase object must have a
    \Index object with \\ \token{arrays:arrayDimension} attribute set
    to 0 before adding a \Index object with \\ \token{arrays:arrayDimension} attribute set
    to 1. Similarly, the \ListOfIndices in an \SBase object must have
    \Index objects, where one of them has \token{arrays:arrayDimension} attribute set
    to 0 and the other set to 1 before adding a \Index object with  \token{arrays:arrayDimension} attribute set to 2. (Reference:
  \sbmlthreearrays, \sec{sec:dimension}.) }

\printValid{The \ListOfIndices in an \SBase object must not have multiple
    \Index objects with the same \token{arrays:arrayDimension} attribute. (Reference:
  \sbmlthreearrays, \sec{sec:index}.) }

\printValid{A \ListOfIndices object may have the optional SBML core attributes \token{metaid} and \token{sboTerm}.  No other attributes from the SBML Level~3 Core namespace or the Arrays namespace are permitted on a \ListOfIndices object.  (Reference: \sbmlthreearrays, \sec{sec:index}.) }

\printValid{Only SBML objects that include defined attributes of type \token{SIdRef} are permitted to have a \ListOfIndices.  For SBML Level~3 Core, this includes 
\token{Model} to reference a \token{conversionFactor} element,
\token{Species} to reference a \token{compartment} or a
\token{conversionFactor} element,
\token{Reactions} to reference a \token{compartment},
\token{Initial assignments}  to reference a \token{symbol},
\token{Rules}  to reference a \token{variable},
\token{Species references}  to reference a \token{species}, and
\token{Events assignments}  to reference a \token{variable}.  In addition to these, any SBML object in a package with a defined attribute of type \token{SIdRef} may also have a \ListOfIndices. (Reference: \sbmlthreearrays, \sec{sec:index}.)}

\subsubsection*{Rules for \class{Dimension} objects}
\setcounter{arraysCtr}{20201} 

\printValid{A \Dimension object may have the optional SBML
  Level~3 Core attributes \token{metaid} and \token{sboTerm}.  No
  other attributes from the SBML Level~3 Core namespace are permitted
  on a \Dimension object.  (Reference: SBML Level~3 Version~1 Core,
  Section~3.2.) }

\printValid{A \Dimension object must have a value
  for the attributes
  \token{arrays:arrayDimension} and \\
  \token{arrays:size}, and may additionally have the
  attributes \token{arrays:id} and \token{arrays:name}. (Reference: \sbmlthreearrays,
  \sec{sec:dimension}.) }

\printValid{The value of the
  \token{arrays:arrayDimension} attribute, if set on a given
  \Dimension object, must be either 0, 1 or 2.  (Reference:
  \sbmlthreearrays, \sec{sec:dimension}.) }

\printValid{The value of the
  \token{arrays:size} attribute, if set on a given
  \Dimension object, must be a valid \token{SIdRef} to an object of type \token{Parameter}.  (Reference: \sbmlthreearrays, \sec{sec:dimension}.) }

\printValid{The value of the \token{Parameter} referenced by the
  \token{arrays:size} attribute must be a non-negative scalar constant. (Reference:
  \sbmlthreearrays, \sec{sec:dimension}.) }

\subsubsection*{Rules for \class{Index} objects} 
\setcounter{arraysCtr}{20301}

\printValid{An \Index object may have the optional SBML
  Level~3 Core attributes \token{metaid} and \token{sboTerm}.  No
  other attributes from the SBML Level~3 Core namespace are permitted
  on a \Index object.  (Reference: SBML Level~3 Version~1 Core,
  Section~3.2.) }

\printValid{An \Index object must have a value
  for the attributes
  \token{arrays:arrayDimension}, and \\
  \token{arrays:referencedAttribute} . (Reference: \sbmlthreearrays,
  \sec{sec:index}.) }

\printValid{The value of the
  \token{arrays:referencedAttribute} attribute, if set on a given
  \Index object, must be an existing attribute of type \token{SIdRef} with a value that references a
  valid \token{SId}.  (Reference:
  \sbmlthreearrays, \sec{sec:index}.) }

\printValid{The value of the
  \token{arrays:arrayDimension} attribute, must be either 0, 1 or 2.  (Reference:
  \sbmlthreearrays, \sec{sec:index}.) }

\printValid{The object referenced by the \token{SIdRef} indicated by the \token{arrays:referencedAttribute} attribute must include an \token{arrays:arrayDimension} matching the \token{arrays:arrayDimension} for the \Index. (Reference:
  \sbmlthreearrays, \sec{sec:index}.) }

\printValid{An \Index object must have exactly one MathML math element . (Reference: \sbmlthreearrays,
  \sec{sec:index}.) }

\printValid{The MathML math element in an \Index object must evaluate to a non-negative integer, and it must be statically computable.  In other words, any identifier that appears in the math element, other than a \Dimension \primtype{id} for the object with this \Index, must be a constant. (Reference: \sbmlthreearrays, \sec{sec:index}.)}

% If you look at the apdx-validation.tex file for any of the accepted packages you will see the macros in use.

% You can also probably cut and paste the opening paragraphs :-)

% Note with the numbers for arrays they will be

% arrays-nnnnn

% and then the first three numbers should be consistent with the categories from core for the more general 10xxx types rules; so
% 101xx for general xml rules
% 102xx for mathml rules
% etc

% Specific component type rules would be 20nxx where n is a new number for each component.

% So Dimension related rules would be 201xx

% and Index ones would be 202xx

%% -------

%  Yes indeed.  I assume you are using the sbmlpkgspec latex class.  In the documentation for that class (which is in a PDF file with the sbmlpkgclass style file kit, https://sourceforge.net/projects/sbml/files/specifications/tex/) see section 2.9.

\section{Example Algorithm for Producing a ``flattened'' Model}
\label{flatten}
