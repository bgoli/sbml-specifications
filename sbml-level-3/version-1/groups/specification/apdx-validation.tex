% -*- TeX-master: "main" -*-

\section{Validation of SBML documents using Groups constructs}
\label{apdx-validation}
\label{validation-rules}

This section summarizes all the conditions that must (or in some cases, at least \emph{should}) be true of an SBML Level~3 Version~1 model that uses the Groups package.  We use the same conventions that are used in the SBML Level~3 Version~1 Core specification document.  In particular, there are different degrees of rule strictness.  Formally, the differences are expressed in the statement of a rule: either a rule states that a condition \emph{must} be true, or a rule states that it \emph{should} be true.  Rules of the former kind are strict SBML validation rules---a model encoded in SBML must conform to all of them in order to be considered valid.  Rules of the latter kind are consistency rules.  To help highlight these differences, we use the following three symbols next to the rule numbers:

\begin{description}

\item[\hspace*{6.5pt}\vSymbol\vsp] A \vSymbolName indicates a \emph{requirement} for SBML conformance. If a model does not follow this rule, it does not conform to the Groups package specification.  (Mnemonic intention behind the choice of symbol: ``This must be checked.'')

\item[\hspace*{6.5pt}\cSymbol\csp] A \cSymbolName indicates a \emph{recommendation} for model consistency.  If a model does not follow this rule, it is not considered strictly invalid as far as the Groups package specification is concerned; however, it indicates that the model contains a physical or conceptual inconsistency.  (Mnemonic intention behind the choice of symbol: ``This is a cause for warning.'')

\item[\hspace*{6.5pt}\mSymbol\msp] A \mSymbolName indicates a strong recommendation for good modeling practice.  This rule is not strictly a matter of SBML encoding, but the recommendation comes from logical reasoning.  As in the previous case, if a model does not follow this rule, it is not considered an invalid SBML encoding.  (Mnemonic intention behind the choice of symbol: ``You're a star if you heed this.'')

\end{description}

The validation rules listed in the following subsections are all stated or implied in the rest of this specification document.  They are enumerated here for convenience.  Unless explicitly stated, all validation rules concern objects and attributes specifically defined in the Groups package.

For \notice convenience and brievity, we use the shorthand ``\token{groups:x}'' to stand for an attribute or element name \token{x} in the namespace for the Groups package, using the namespace prefix \token{groups}.  In reality, the prefix string may be different from the literal ``\token{groups}'' used here (and indeed, it can be any valid XML namespace prefix that the modeler or software chooses).  We use ``\token{groups:x}'' because it is shorter than to write a full explanation everywhere we refer to an attribute or element in the Groups package namespace.


\subsection*{General rules about the Groups package}

\validRule{groups-10101}{To conform to Version 1 of the Groups package specification for SBML Level~3, an
  SBML document must declare the use of the following XML Namespace:\\
  \uri{http://www.sbml.org/sbml/level3/version1/groups/version1}.  (References: \sbmlthreegroups, \sec{xml-namespace}.)}
  
\validRule{groups-10102}{Wherever they appear in an SBML document, elements and attributes from the Groups package must be declared either implicitly or explicitly to be in the XML namespace\\ \uri{http://www.sbml.org/sbml/level3/version1/groups/version1}.  (References: \sbmlthreegroups, \sec{xml-namespace}.) }


\subsubsection*{Rules for the extended \class{SBML} class} 

\validRule{groups-10201}{In all SBML documents using the Groups package, the \SBML object must include a value for
  the attribute \token{groups:required} attribute.  (References: SBML Level~3 Version~1 Core, Section~4.1.2.)}
  
\validRule{groups-10202}{The value of attribute \token{groups:required} on
  the \SBML object must be of the data type \token{boolean}.
  (References: SBML Level~3 Version~1 Core, Section~4.1.2.) }
  
\validRule{groups-10203}{The value of attribute \token{groups:required} on
  the \SBML object must be set to \val{false} (References: \sbmlthreegroups, \sec{xml-namespace}.) }

\subsection*{General rules about attributes} 

%VERSION2
%\validRule{groups-10301}{(Extends validation rule \#10301 in the SBML Level~3 Version~1 Core specification.) Within a \Model object, the values of the attributes \token{id} and \token{groups:id} on every instance of the following classes of objects must be unique across the set of all \token{id} and \token{groups:id} attribute values of all such objects in a model: the \Model itself, plus all contained \FunctionDefinition, \Compartment, \Species, \Reaction, \SpeciesReference, \ModifierSpeciesReference, \Event, and \Parameter objects, plus the \Group, \Member, \ListOfMemberConstraints, and \MemberConstraint objects defined by the Groups package, plus any objects defined by any other package with \token{package:id} attributes defined as falling in the 'SId' namespace. (References: \sbmlthreegroups, \sec{group-class}.) }
\validRule{groups-10301}{(Extends validation rule \#10301 in the SBML Level~3 Version~1 Core specification.) Within a \Model object, the values of the attributes \token{id} and \token{groups:id} on every instance of the following classes of objects must be unique across the set of all \token{id} and \token{groups:id} attribute values of all such objects in a model: the \Model itself, plus all contained \FunctionDefinition, \Compartment, \Species, \Reaction, \SpeciesReference, \ModifierSpeciesReference, \Event, and \Parameter objects, plus the \Group, and \Member objects defined by the Groups package, plus any objects defined by any other package with \token{package:id} attributes defined as falling in the 'SId' namespace. (References: \sbmlthreegroups, \sec{group-class}.) }
\validRule{groups-10302}{The value of a \token{groups:id} attribute must
  always conform to the syntax of the SBML data type \primtype{SId}.
  (References: SBML Level~3 Version~1 Core, Section~3.1.7.)}

\validRule{groups-10303}{The value of a \token{groups:name} attribute
  must always conform to the syntax of type \primtype{string}.  
  (References: SBML Level~3 Version~1 Core, Section~3.1.1.)}

%\clearpage

\validRule{groups-10304}{The value of a \token{groups:idRef} attribute on \Member objects must conform to the syntax of the SBML data type \primtype{SIdRef}.  (References: \sbmlthreegroups, \sec{member-class}.) }

\validRule{groups-10305}{The value of a \token{groups:metaIdRef} attribute on \Member objects must conform to the syntax of the SBML data type \primtype{IDREF}.  (References:\sbmlthreegroups, \sec{member-class}.) }

%VERSION2
%\validRule{groups-10306}{The value of a \token{groups:membersShareType} attribute on \ListOfMemberConstraints objects must be of the data type \token{boolean}.  (References:\sbmlthreegroups, \sec{listOfMemberConstraints-class}.) }

%\validRule{groups-10307}{The value of a \token{groups:identicalAttribute} attribute on \MemberConstraint objects must be of the data type \token{string}.  (References:\sbmlthreegroups, \sec{listOfMemberConstraints-class}.) }

%\validRule{groups-10308}{The value of a \token{groups:distinctAttribute} attribute on \MemberConstraint objects must be of the data type \token{string}.  (References:\sbmlthreegroups, \sec{listOfMemberConstraints-class}.) }


\subsection*{Rules for extended \class{Model} objects} 

\validRule{groups-20101}{There may be at most one \ListOfGroups container object within a \Model object, named \val{listOfGroups}.  (References: \sbmlthreegroups, \sec{model-class}.) }

\validRule{groups-20102}{A \ListOfGroups object within a \Model object is optional, but if present, must not be empty.  (References: \sbmlthreegroups, \sec{model-class}.) }
  
\validRule{groups-20103}{Apart from the general notes and annotation subobjects permitted on all SBML objects, a \ListOfGroups container object may only contain \Group objects, named \val{group}.  (References: \sbmlthreegroups, \sec{model-class}.) }

\validRule{groups-20104}{A \ListOfGroups object may have the optional SBML core attributes \token{metaid} and \token{sboTerm}.  No other attributes from the SBML Level~3 Core namespace or the Groups namespace are permitted on a \ListOfGroups object.  (References: \sbmlthreegroups, \sec{model-class}.) }


\subsection*{Rules for \class{Group} objects} 

\validRule{groups-20201}{A \Group object may have the optional SBML Level~3 Core attributes \token{metaid} and \token{sboTerm}.  No other attributes from the SBML Level~3 Core namespace are permitted on a \Group object.  (References: SBML Level~3 Version~1 Core, Section~3.2.) }

\validRule{groups-20202}{A \Group object may have the attributes \token{groups:id} and \token{groups:name}, and must have the attribute \token{groups:kind}  No other attributes from the Groups namespace are permitted on a \Group object. (References: \sbmlthreegroups, \sec{group-class}.) }

\validRule{groups-20203}{The value of the \token{groups:kind} attribute on a \Group object must have one of the following values: \val{classification}, \val{partonomy}, or \val{collection}.  These are the only permitted values for the \token{groups:kind} attribute on \Group. (References: \sbmlthreegroups, \sec{group-class}.) }

\validRule{groups-20204}{There may be at most one \ListOfMembers container object within a \Group object, named \val{listOfMembers}.  (References: \sbmlthreegroups, \sec{group-class}.) }

\validRule{groups-20205}{A \ListOfMembers object within a \Group object is optional, but if present, must not be empty.  (References: \sbmlthreegroups, \sec{group-class}.) }

\validRule{groups-20206}{Apart from the general notes and annotation subobjects permitted on all SBML objects, a \ListOfMembers container object may only contain \Member objects, named \val{member}.  (References: \sbmlthreegroups, \sec{group-class}.) }

\validRule{groups-20207}{A \ListOfMembers object may have the optional SBML core attributes \token{metaid} and \token{sboTerm}.  No other attributes from the SBML Level~3 Core namespace or the Groups namespace are permitted on a \ListOfMembers object.  (References: \sbmlthreegroups, \sec{group-class}.) }

%VERSION2
%\validRule{groups-20208}{There may be at most one \ListOfMemberConstraints object within a \Group object, with the name \val{listOfMemberConstraints}.  (References: \sbmlthreegroups, \sec{group-class}.) }

\consistencyRule{groups-20209}{If multiple \ListOfMembers objects contain \Member elements that reference the same SBML object, the \token{sboterm} and any child \Notes or \Annotation elements set for those \ListOfMembers should be consistent, as they all should apply to the same referenced object.  (References: \sbmlthreegroups, \sec{listofmembers-class}.) }



\subsection*{Rules for \class{Member} objects} 

\validRule{groups-20301}{A \Member object may have the optional SBML Level~3 Core attributes \token{metaid} and \token{sboTerm}.  No other attributes from the SBML Level~3 Core namespace are permitted on a \Group object.  (References: SBML Level~3 Version~1 Core, Section~3.2.) }

\validRule{groups-20302}{A \Member object must have a value for one (and exactly one) of the attributes \token{groups:idRef} or \token{groups:metaIdRef}, and may additionally have the attributes \token{groups:id} and \token{groups:name}.  No other attributes from the Groups namespace are permitted on a \Member object. (References: \sbmlthreegroups, \sec{member-class}.) }

\validRule{groups-20303}{The value of the \token{groups:idRef} attribute, if set on a given \Member object, must be the value of an \token{id} attribute on an existing object in the SId namespace of the parent \Model.  (References: \sbmlthreegroups, \sec{member-class}.) }

\validRule{groups-20304}{The value of the \token{groups:metaIdRef} attribute, if set on a given \Member object, must be the value of a meta identifier on an existing object in the parent \Model.  (References: \sbmlthreegroups, \sec{member-class}.) }


%\subsection*{Rules for \class{ListOfMemberConstraints} objects} 

%\validRule{groups-20401}{A \ListOfMemberConstraints object may have the optional SBML Level~3 Core attributes \token{metaid} and \token{sboTerm}.  No other attributes from the SBML Level~3 Core namespace are permitted on a \Group object.  (References: SBML Level~3 Version~1 Core, Section~3.2.) }

%\validRule{groups-20402}{A \ListOfMemberConstraints object must have the attribute \token{groups:membersShareType}, and may additionally have the attributes \token{groups:id} and \token{groups:name}.  No other attributes from the Groups namespace are permitted on a \ListOfMemberConstraints object. (References: \sbmlthreegroups, \sec{listOfMemberConstraints-class}.) }

%\validRule{groups-20403}{A \ListOfMemberConstraints object may contain one or more \MemberConstraint children, named \val{memberConstraint}.  (References: \sbmlthreegroups, \sec{listOfMemberConstraints-class}.) }


%\subsection*{Rules for \class{MemberConstraint} objects} 

%\validRule{groups-20501}{A \MemberConstraint object may have the optional SBML Level~3 Core attributes \token{metaid} and \token{sboTerm}.  No other attributes from the SBML Level~3 Core namespace are permitted on a \Group object.  (References: SBML Level~3 Version~1 Core, Section~3.2.) }

%\validRule{groups-20502}{A \MemberConstraint object must have a value for one (and exactly one) of the attributes \token{groups:distinctAttribute} and \token{groups:identicalAttribute}, and may additionally have the attributes \token{groups:id} and \token{groups:name}.  No other attributes from the Groups namespace are permitted on a \MemberConstraint object. (References: \sbmlthreegroups, \sec{memberConstraint-class}.) }

%\validRule{groups-20503}{The value of the \token{groups:distinctAttribute} attribute, if set on a given \MemberConstraint object, must be the name of an attribute shared by all referenced members of its parent \Group.  (References: \sbmlthreegroups, \sec{distinctattribute-attribute}.) }

%\validRule{groups-20504}{The value of the \token{groups:identicalAttribute} attribute, if set on a given \MemberConstraint object, must be the name of an attribute shared by all referenced members of its parent \Group.  (References: \sbmlthreegroups, \sec{identicalattribute-attribute}.) }

%\validRule{groups-20505}{The values of any attribute named by a \token{groups:distinctAttribute} attribute on an \MemberConstraint object must be different across all referenced members of that \MemberConstraint's parent \Group.  (References: \sbmlthreegroups, \sec{distinctattribute-attribute}.) }

%\validRule{groups-20506}{The values of any attribute named by a \token{groups:identicalAttribute} attribute on an \MemberConstraint object must be the same across all referenced members of that \MemberConstraint's parent \Group.  (References: \sbmlthreegroups, \sec{identicalattribute-attribute}.) }

