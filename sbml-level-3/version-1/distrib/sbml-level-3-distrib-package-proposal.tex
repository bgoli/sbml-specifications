\documentclass[draftspec]{sbmlpkgspec}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{microtype}

%macros:
\newcommand{\fixttspace}{\hspace*{1pt}}

\newcommand{\sbmlthreecore}{SBML Level~3 Version~1 Core\xspace}

\newcommand{\sbmlthreedistrib}{SBML Level~3 Package Specification for Distributions, Version~1\xspace}

\newcommand{\PredefinedPDF}{\defRef{PredefinedPDF}{predefinedPDF-class}}
\newcommand{\DrawFromDistribution}{\defRef{DrawFromDistribution}{drawFromDistribution-class}}
\newcommand{\ExplicitPDF}{\defRef{ExplicitPDF}{explicitPDF-class}}
\newcommand{\Input}{\defRef{Input}{input-class}}
\newcommand{\ExplicitPMF}{\defRef{ExplicitPMF}{explicitPMF-class}}
\newcommand{\Uncertainty}{\defRef{Uncertainty}{uncertainty-class}}

\newcommand{\LambdaClass}{\textbf{\class{Lambda}}\xspace}
\newcommand{\Math}{\textbf{\class{Math}}\xspace}
\newcommand{\MathChangedDeclaration}{\textbf{\class{MathChangedDeclaration}}\xspace}

\newcommand{\arraysshort}{arrays\xspace}
\newcommand{\arrays}{Arrays and Sets\xspace}
\newcommand{\distribshort}{\emph{distrib}\xspace}
\newcommand{\distrib}{Distributions\xspace}
\newcommand{\mathml}{MathML\xspace}
\newcommand{\mlambda}{\class{Lambda}\xspace}
\newcommand{\mmath}{\class{Math}\xspace}
\newcommand{\numl}{NuML\xspace}
\newcommand{\req}{Required Elements\xspace}
\newcommand{\uncertml}{UncertML\xspace}
\newcommand{\unidistrib}{\abstractclass{IUncertainty}\xspace}
\newcommand{\sbmlverone}{SBML Level 3 Version 1\xspace}

\reversemarginpar  % Want "\watchout" to be put on the left, not the right.
\newcommand{\watchout}{\marginpar{\hspace*{34pt}\raisebox{-0.5ex}{\Large\ding{43}}}}
\newcommand{\controversial}{\marginpar{\hspace*{34pt}\raisebox{-0.5ex}{\Large?}}}

\begin{document}

\packageTitle{The Distributions Package\\for SBML Level 3}
\packageVersion{Version 0.11 (Draft)}
\packageVersionDate{XX May, 2013}
%\packageGeneralURL{http://sbml.org/Community/Wiki/SBML_Level_3_Proposals/Distributions_and_Ranges}
%\packageThisVersionURL{}

\author{%
  \begin{tabular}{c>{\hspace{20pt}}c}
    \multicolumn{2}{c}{\Large\bf{Authors}}\\\\
    Stuart L Moodie                     & Lucian P Smith\\
    \mailto{moodie@ebi.ac.uk}           & \mailto{lpsmith@uw.edu}\\
    EMBL-EBI                            & California Institute of Technology\\
    Hinxton, UK                         & Seattle, WA, USA\\
  \\
    \multicolumn{2}{c}{\Large\bf{Contributors}}\\\\
    Nicolas Le Nov\`{e}re               & Darren Wilkinson\\
    \mailto{lenov@babraham.ac.uk}       & \mailto{darren.wilkinson@ncl.ac.uk}\\
    Babraham Institute                  & University of Newcastle\\
    Babraham, UK                        & Newcastle, UK\\
  \\
    Maciej Swat                         & Sarah Keating\\
    \mailto{mjswat@ebi.ac.uk}           & \mailto{skeating@ebi.ac.uk}\\
    EMBL-EBI                            & EMBL-EBI\\
    Hinxton, UK                         & Hinxton, UK\\
\\
     \multicolumn{2}{c}{ Colin Gillespie}\\
     \multicolumn{2}{c}{\mailto{c.gillespie@ncl.ac.uk}}\\
     \multicolumn{2}{c}{University of Newcastle}\\
     \multicolumn{2}{c}{ Newcastle, UK}\\
\end{tabular}
}

\frontNotice{Disclaimer: This is a working draft of the SBML Level 3
  ``distib'' package proposal. It is not a normative document.  Please
  send comments and other feedback to the mailing list:
  \mailto{sbml-distrib@lists.sourceforge.net.}}

\maketitlepage
\maketableofcontents

\section*{Revision History}

\begin{edtable}{tabularx}{\linewidth}{c c c X }\toprule
\textbf{Version} & \textbf{Date} & \textbf{Author} & \textbf{Comments} \\ \midrule
0.1 (Draft) & 15 Oct 2011 & Stuart Moodie & First draft \\ \midrule
0.2 (Draft) & 16 Oct 2011 & Stuart Moodie & Added introductory text
and background info. Other minor changes etc. \\ \midrule
0.3 (Draft) & 16 Oct 2011 & Stuart Moodie & Filled empty invocation
semantics section.\\ \midrule
0.4 (Draft) & 4 Jan 2012 & Stuart Moodie & Incorporated comments from
NlN, MS and SK. Some minor revisions and corrections.\\  \midrule
0.5 (Draft) & 6 Jan 2012 & Stuart Moodie & Incorporated addition
comments on aim of package from NlN.\\ \midrule
0.6 (Draft) & 19 Jul 2012 & Stuart Moodie & Incorporated revisions
discussed and agreed at HARMONY 2012.\\ \midrule
0.7 (Draft) & 6 Aug 2012 & Stuart Moodie & Incorporated review
comments from Maciej Swat and Sarah Keating.\\ \midrule
0.8 (Draft) & 21 Dec 2012 & Stuart Moodie & Incorporated changes
suggested at combine and subsequently through list discussions.\\ \midrule
0.9 (Draft) & 9 Jan 2013 & Stuart Moodie & Incorporated corrections
and comments from Maciej Swat and Sarah Keating.\\ \midrule
0.10 (Draft) & 10 Jan 2013 & Stuart Moodie & Modified based on comments
from MS.\\
0.11 (Draft) & XX May 2013 & Lucian Smith and Stuart Moodie & Modified based on Stuart's proposals and PWG discussion.\\
\bottomrule
\end{edtable}

\section{Introduction and motivation}

\subsection{What is it?}

The \distrib package (also affectionately known as \distribshort for
short) provides an extension to SBML Level 3 that enables a model to encode and sample from
both discrete and continuous probability distributions, and provide
the ability to annotate elements with information about the distribution their
values were drawn from. 
Applications of the package include for instance descriptions of
population based models: an important subset of which are
pharmacokinetic/pharmacodynamic (PK/PD) models\footnote{for more
  information see: \url{http://www.pharmpk.com/}.}, which are used to
model the action of drugs.

Note that originally the package was called Distributions and Ranges,
but Ranges and the use of probability distributions to describe
statistical uncertainly are no longer in the scope, hence the name change.

\subsection{Scope}

The \distrib package adds support to SBML for sampling from a
probability distribution. In particular the following are in scope:

\begin{itemize}
\item Sampling from a continuous distribution.
\item Sampling from a discrete distribution.
\item Sampling from user-defined probability density function.
\item Sampling from user-defined discrete probability density function.
\item The specification of descriptive statistics (mean, standard
  deviation, standard error, etc.).
\end{itemize}

At one point the following were considered for inclusion in this
package but are now \textbf{out of scope}:

\begin{itemize}
\item Stochastic differential equations.
\item Other functions used to characterise a probability distribution,
  such as cumulative distribution functions (CDF) or survival functions, etc.
\end{itemize}

\subsection{This Document}

This proposal describes the consensus view of workshop participants
and subscribers to the sbml-distrib mailing list. Although it was
written by the listed author(s) it does not soley reflect their views nor is
it their proposal. Rather, it is their understanding of the consensus
view of what the \distrib package should do and how it should do
it. The contributors listed have made significant contributions to the
development and writing of this specification and are credited
accordingly, but a more comprehensive attribution is provided in the
acknowledgements (\sec{sec:acknowledgements}).

Finally, there are issues that have arisen during the writing of this
document (\ref{sec:unresolved}). It is important that they are
considered and resolved and so the author(s) would encourage the
reader to consider them and contribute their ideas or comments ---
indeed any feedback about this proposal --- to the \distribshort
discussion list\footnote{\mailto{sbml-distrib@lists.sourceforge.net}}.

Once the proposal is finalised this will be the first step towards the
formal adoption of the \distribshort as a package in SBML Level
3. After this, two implementations based on this proposal are required
and then a vote on its adoption by the SBML community. The proposal
will then provide the basis for a future package specification
document. More details of the SBML package adoption process can be
found at: \url{http://sbml.org/Documents/SBML_Development_Process}.


\subsection{Conventions used in this document}

As we are early in the package proposal process there will be some
parts of this proposal where there is no clear consensus on the
correct solution or only recent agreement or agreement by a group
which may not be representative of the SBML community as a
whole. These cases are indicated by the \controversial question mark
in the left margin (illustrated). The reader should pay particular
attention to these points and ideally provide feedback, especially if
they disagree with what is proposed. Similarly there will be points
--- especially as the proposal is consolidated --- which are agreed,
but which the reader should take note of and perhaps read again. These
points \watchout are emphasised by the hand pointer in the left margin
(illustrated).

\section{Background}

\subsection{Problems with current SBML approaches}

SBML Level 3 Core has no direct support for encoding random values
within a model. Currently there is no workaround within the core
language itself, although it is possible to define such information
using annotations within SBML itself. Frank Bergmann had proposed such
an semi-formalised extension for use with SBML L2 [REF?].

\subsection{Past work on this problem or similar topics}

\subsubsection{The Newcastle Proposal}
\label{sec:newcastle proposal}

In 2005 there was a proposal from Colin Gillespie and others
\footnote{\url{http://sbml.org/Community/Wiki/SBML\_Leve\l_3\_Proposals/Distributions\_and\_Ranges}}
to introduce support for probability distributions in the SBML core specification. This
was based on their need to use such distributions to represent the
models they were creating as part of the BASIS project
(\url{http://www.basis.ncl.ac.uk}).

They proposed that distributions could be referred to in SBML using
the \class{csymbol} element in the \mathml subset used by
the SBML Core specification. An example is below:

\begin{example}
<xmlns=''http://www.w3.org/1998/Math/MathML''>
  <apply>
    <csymbol encoding=''text''
        definitionURL=''http://www.sbml.org/sbml/symbols/uniformRandom''>
      uniformRandom
    </csymbol>
    <ci>mu</ci>
    <ci>sigma</ci>
  </apply>
</math>
\end{example}

This required that a library of definitions be maintained as part of
the SBML standard and in their proposal they defined an initial small
set of commonly used distributions. The proposal was never
implemented.

\subsubsection{Seattle 2010}

The ``distrib'' package was discussed at the Seattle SBML Hackathon%
\footnote{\url{http://sbml.org/Events/Hackathons/The_2010_SBML-BioModels.net_Hackathon}}
and this section is an almost verbatim reproduction of Darren
Wilkinson's report on the
meeting\footnote{\url{http://sbml.org/Forums/index.php?t=tree\&goto=6141\&rid=0}}. There
Darren presented an overview of the problem%
\footnote{Slides: \url{http://sbml.org/images/3/3b/Djw-sbml-hackathon-2010-05-04.pdf}}%
\footnote{Audio: \url{http://sbml.org/images/6/67/Wilkinson-distributions-2010-05-04.mov}},
building on the old proposal from the Newcastle group (see above:
\ref{sec:newcastle proposal}).  There was broad support at the meeting
for development of such a package, and for the proposed feature
set. Discussion following the presentation led to a consensus on the
following points:

\begin{itemize}
\item There is an urgent need for such a package.
\item It is important to make a distinction between a description of
  uncertainty regarding a model parameter and the mechanistic process
  of selecting a random number from a probability distribution, for
  applications such as parameter scans and experimental design
\item It is probably worth including the definition of PMFs, PDFs and CDFs in the package
\item It is worth including the definition of random distributions using particle representations within such a package, though some work
 still needs to be done on the precise representation
\item It could be worth exploring the use of xinclude to point at particle
representations held in a separate file
\item Random numbers must not be used in rate laws or anywhere else that
 is continuously evaluated, as then simulation behaviour is not
 defined
\item Although there is a need for a package for describing extrinsic
 noise via stochastic differential equations in SBML, such mechanisms
 should not be included in this package due to the considerable
 implications for simulator developers
\item We probably don't want to layer on top of \uncertml
 (www.uncertml.org), as this spec is fairly heavy-weight, and
 somewhat tangential to our requirements
\item A random number seed is not part of a model and should not be
 included in the package
\item The definition of truncated distributions and the specification of
 hard upper and lower bounds on random quantities should be
 considered.
\end{itemize}

It was suggested that new constructs should be introduced into SBML by
the package embedded as user-defined functions using the following
syntax:

\begin{example}
<listOfFunctionDefinitions>
  <functionDefinition id="myNormRand">
    <distrib:####>
      #### distrib binding information here ####
    </distrib:####>
    <math>
      <lambda>
        <bvar>
          <ci>mu</ci>
          <ci>sigma</ci>
        </bvar>
        <ci>mu</ci>
      </lambda>
    </math>
  </functionDefinition>
</listOfFunctionDefinitions>
\end{example}

which allows the use of a "default value" by simulators which do not
understand the package (but simulators which do will ignore the <math>
element). The package would nevertheless be "required", as it will not
be simulated correctly by software which does not understand the
package.

Informal discussions following the break-out covered topics such as:

\begin{itemize}
\item how to work with vector random quantities in the absence of the vector
element in the MathML subset used by SBML
\item how care must be taken with the semantics of random variables
  and the need to both:
\begin{itemize}
\item reference multiple independent random quantities at a given
  time
\item make multiple references to the same random quantity at a given
time.
\end{itemize}
\end{itemize}

\subsubsection{Hinxton 2011}

Detailed discussion was continued at the Statistical Models Workshop
in Hinxton in June 2011%
\footnote{\url{http://sbml.org/Events/Other_Events/statistical_models_workshop_2011}}. There
those interested in representing Statistical Models in SBML came
together to work out the details of how this package would work in
detail. Dan Cornford from the \uncertml
project\footnote{\url{http://www.uncertml.org/}} attended the meeting
and described how that resource could be used to describe uncertainty
and in particular probability distributions. Perhaps the most
significant decision at this meeting was to adopt the \uncertml
resource as a controlled vocabulary that is referenced by the \distrib package.

Much has changed since this meeting, but the output from this meeting
was the basis for the first version of this proposal.


\subsubsection{HARMONY 2012: Maastricht}

Two sessions were dedicated to discussion of \distrib at HARMONY based
around the proposals described in version 0.5 of this document. In
addition there was discussion about the \arrays proposal which was
very helpful in solving the problem of multivariate distributions in
\distrib. The following were the agreed outcomes of the meeting:

\begin{itemize}
\item The original proposal included UncertML markup directly in the
  function definition. This proved unwieldy and confusing and has been
  replaced by a more elegant solution that eliminates the UncertML
  markup and integrates well with the fallback function (see details
  below).
\item Multivariate distributions can be supported using the \arrays
  package to define a covariance matrix.
\item User defined continuous distributions would define a PDF in
  \mathml.
\item Usage semantics were clarified so that invokation of a function
  definition implied a value was sampled from the specified
  distribution.
\item It was agreed from which sections of an SBML model a
  distribution could be invoked.
\item Statistical descriptors of variables (for
  example mean and standard deviation) would be separated from
  \distrib and either provided in a new package or in a later version
  of SBML L3 core.
\end{itemize}

\subsubsection{COMBINE 2012: Toronto}

The August proposal was reviewed and an improvement was agreed to
the user-defined PMF part of the proposal. In particular is was agreed
that the categories should be defined by \distribshort classes rather
than by passing in the information as an array. Questions were also raised
about whether \uncertml was suitably well defined to be used as an
external definition for probability distributions. This was resolved
subsequent to the meeting with a teleconference to Dan Cornford and
colleagues. These changes are incorporated here. Finally, there was
considerable debate about whether to keep the dependence of
\distribshort on the Arrays package in order to support multi-variate
distributions. The outcome was an agreement that we would review this
at the end of 2012, based on the results of an investigation
into how feasible it would be to implement \arrays as a package.

\subsubsection{2013 Package Working Group discussions}

Early 2013 saw a good amount of discussion on the \distribshort Package Working Group mailing list, spurred by proposals by Stuart Moodie\footnote{\url{http://thestupott.wordpress.com/2013/03/12/an-improved-distrib-proposal/}}.  While not all of his suggestions ended up being fully accepted by the group, several changes were accepted, including:

\begin{itemize}
\item To use UncertML as actual XML, instead of as a set of reference definitions.
\item To use UncertML to encode descriptive statistics of SBML elements such as mean, standard deviation, standard error, etc.) bringing this capability back in scope for this package.
\end{itemize}

\section{Proposed syntax and semantics}

\subsection{Overview}

Following the precedent set by the SBML Level~3 Core specification
document, we use UML~1.0 (Unified Modeling Language;
\citealt{eriksson:1998,oestereich:1999}) class diagram notation to
define the constructs provided by this package.  We also use color in
the diagrams to carry additional information for the benefit of those
viewing the document on media that can display color.  The following are
the colors we use and what they represent:

\begin{itemize}

\item[\raisebox{2.75pt}{\colorbox{black}{\rule{0.8pt}{0.8pt}}}]
  \emph{Black}: Items colored black in the UML diagrams are components
  taken unchanged from their definition in the SBML Level~3 Core
  specification document.

\item[\raisebox{2.75pt}{\colorbox{mediumgreen}{\rule{0.8pt}{0.8pt}}}]
  \emph{\textcolor{mediumgreen}{Green}}: Items colored green are
  components that exist in SBML Level~3 Core, but are extended by this
  package.  Class boxes are also drawn with dashed lines to further
  distinguish them.

\item[\raisebox{2.75pt}{\colorbox{darkblue}{\rule{0.8pt}{0.8pt}}}]
  \emph{\textcolor{darkblue}{Blue}}: Items colored blue are new
  components introduced in this package specification.  They have no
  equivalent in the SBML Level~3 Core specification.

\end{itemize}

We also use the following typographical conventions to distinguish the
names of objects and data types from other entities; these conventions
are identical to the conventions used in the SBML Level~3 Core specification
document:

\begin{description}
  
\item \abstractclass{AbstractClass}: Abstract classes are never
  instantiated directly, but rather serve as parents of other classes.
  Their names begin with a capital letter and they are printed in a
  slanted, bold, sans-serif typeface.  In electronic document formats,
  the class names defined within this document are also hyperlinked to
  their definitions; clicking on these items will, given appropriate
  software, switch the view to the section in this document containing
  the definition of that class.  (However, for classes that are
  unchanged from their definitions in SBML Level~3 Core, the class names
  are not hyperlinked because they are not defined within this
  document.)
  
\item \class{Class}: Names of ordinary (concrete) classes begin with a
  capital letter and are printed in an upright, bold, sans-serif
  typeface.  In electronic document formats, the class names are also
  hyperlinked to their definitions in this specification document.
  (However, as in the previous case, class names are not hyperlinked if
  they are for classes that are unchanged from their definitions in the
  SBML Level~3 Core specification.)

\item \token{SomeThing}, \token{otherThing}: Attributes of classes, data
  type names, literal XML, and tokens \emph{other} than SBML class
  names, are printed in an upright typewriter typeface.  Primitive types
  defined by SBML begin with a capital letter; SBML also makes use of
  primitive types defined by XML
  Schema~1.0~\citep{biron:2000,fallside:2000,thompson:2000}, but
  unfortunately, XML~Schema does not follow any capitalization
  convention and primitive types drawn from the XML~Schema language may
  or may not start with a capital letter.

\end{description}

For other matters involving the use of UML and XML, we follow the
conventions used in the SBML Level~3 Core specification document.  


\subsection{Namespace URI and other declarations necessary for using this package}
\label{xml-namespace}

Every SBML Level~3 package is identified uniquely by an XML namespace URI.  For an SBML document to be able to use a given Level~3 package, it must declare the use of that package by referencing its URI.  The following is the namespace URI for this version of the \distrib package for \sbmlthreecore:
\begin{center}
\uri{http://www.sbml.org/sbml/level3/version1/distrib/version1}
\end{center}

In addition, SBML documents using a given package must indicate whether understanding the package is required for complete mathematical interpretation of a model.  This is done using the attribute \token{required} on the \token{<sbml>} element in the SBML document.  For the \distrib package, the value of this attribute must be \val{true} if there are any \DrawFromDistribution elements in the model, as these elements override the core definition of a \FunctionDefinition.  Otherwise, the value of this attribute must be \val{false}, because the other elements of the \distrib package do not change the mathematical meaning of the model.

The following fragment illustrates the beginning of a typical SBML model using \sbmlthreecore and this version of the \distrib package:

\begin{example}
<?xml version="1.0" encoding="UTF-8"?>
<sbml xmlns="http://www.sbml.org/sbml/level3/version1/core" level="3" version="1"
      xmlns:distrib="http://www.sbml.org/sbml/level3/version1/distrib/version1"
      distrib:required="true">
\end{example}


\subsection{Primitive data types}
\label{new-primitive-types}

The \distrib package uses the \val{string} primitive data type described in Section~3.1 of the \sbmlthreecore specification, and adds two additional primitive types described below.


\subsubsection{Type \fixttspace\primtypeNC{UncertId}}
\label{primtype-portid}

The type \primtype{UncertId} is derived from \primtype{SId} (\sbmlthreecore specification Section~3.1.7) and has identical syntax.  The \primtype{UncertId} type is used to create local IDs that can be used in the extended \FunctionDefinition objects to refer to the arguments of the function, in much the same way that the identities of the \token{bvar} elements are used in MathML \token{lambda} elements.  Each \primtype{UncertId} has a scope local to the \FunctionDefinition in which it is found.  The
equality of \primtype{UncertId} values is determined by an exact
character sequence match; i.e., comparisons of these identifiers must be
performed in a case-sensitive manner.


\subsubsection{Type \fixttspace\primtypeNC{UncertIdRef}}
\label{primtype-portidref}

Type \primtype{UncertIdRef} is used for references to
identifiers of type \primtype{UncertId}.  This type is derived from
\primtype{UncertId}, but with the restriction that the value of an
attribute having type \primtype{UncertIdRef} must match the value of a
\primtype{UncertId} found in the same parent \FunctionDefinition as the
\primtype{UncertIdRef}.  As with \primtype{UncertId}, the equality of
\primtype{UncertIdRef} values is determined by exact character sequence
match; i.e., comparisons of these identifiers must be performed in a
case-sensitive manner.



\subsection{Defining Distributions}

\subsubsection{The approach}

The \distrib package has two very simple purposes. First, it provides a
mechanism for sampling a random value from a probability
distribution. This implies that it must define the probability distribution and then must sample a
random value from that distribution.

Secondly, it provides a mechanism for annotating elements with information about their uncertainty.  By far the most common use case for this will be to provide the standard deviation for a value, but other uses include defining the exact distribution or the set of samples from which the value was drawn.

There are two ways to define a probability distribution in
\distribshort. The first is to use UncertML to define a distribution
or a probability mass function (PMF).  The second way is to define
a probability density function (PDF) using MathML.

Strictly all we need are the explicit PDF and PMF
definitions. However, one advantage of using the UncertML pre-defined
distributions is that software can easily recognise the distribution
and use an optimised built-in implementation rather than interpreting
the distribution from the PDF definitions. For some
applications such optimisations make important performance
differences.  Another advantage is that some software may only support certain types of distributions, and having them predefined makes it simpler for the software to inform a user that a particular distribution is not supported.

As mentioned above, the distribution must be sampled. In \distribshort
the distributions are sampled when they are invoked. To reuse a
sampled value the value must be assigned to a parameter first, such as through the use of an \InitialAssignment or \EventAssignment.

\subsubsection{Design Overview}

SBML Core is extended by extending the \FunctionDefinition class as
can be seen in the UML representation in \fig{fig:funcdef}. The redefined \FunctionDefinition optionally
contains a single \token{drawFromDistribution} child.

The \FunctionDefinition class must still contain the
\mathml block containing the standard SBML function definition. This is
required to comply with the \emph{Validity after Reduction} rule in the
package design guidelines \cite{sbmll3v1packrule} and ensures a degree
of backwards compatibility for SBML readers and validators that do not
understand the \distribshort package.

\begin{figure}[htb]
\includegraphics[width=0.75\linewidth]{distrib-functionDefinition.pdf}
\caption{The definition of the extended \FunctionDefinition class, plus the \DrawFromDistribution, \Input, \PredefinedPDF, \ExplicitPMF, and \ExplicitPDF classes.  A \DrawFromDistribution element must have exactly one \PredefinedPDF, \ExplicitPMF, or \ExplicitPDF child.  Together, these classes provide a way to transform a \FunctionDefinition to sample from a probability density function or a probability mass function.}
\label{fig:funcdef}
\end{figure}


\subsection{The extended \class{FunctionDefinition} class}

As outlined above, the \FunctionDefinition class is extended to contain a \DrawFromDistribution child.  Because a \FunctionDefinition must have a \LambdaClass child according to \sbmlthreecore, a valid function will still have one, but the \token{drawFromDistribution} child, if present, will override any definition found there.  However, software that does not support \distribshort could potentially invoke the function found in the \LambdaClass element (see \ref{sec:fallbackfunc}).

\subsection{The \class{DrawFromDistribution} class}
\label{drawFromDistribution-class}

As illustrated in \fig{fig:funcdef}, the \DrawFromDistribution class may have any number of \Input children, which act as the arguments to the function--they serve the same role as the \token{bvar} elements of the \LambdaClass child of a \FunctionDefinition.  As such, order is important:  the first \Input child represents the first argument to the function, etc.

It must also have one other child:  a \PredefinedPDF if it is intended to represent a probability density function (PDF) defined by \uncertml, an \ExplicitPMF if it is intended to represent a probability mass function, or an \ExplicitPDF if it is intended to represent an explicit PDF.  Each of these situations is described below.  In all cases, the IDs defined by the \Input objects are used as the variables within the distribution.

\subsection{The \class{Input} class}
\label{input-class}

The \Input class mimics the \token{bvar} elements of MathML lambda functions.  It has a single text node child, which must contain a \primtype{string} (optionally surrounded by whitespace) of type \primtype{UncertId}.  These IDs represent the arguments to the function, and serve as local identifiers, referenced only by the other children of the \DrawFromDistribution class. See the examples in \ref{sec:fd-examples} for more details.

Because the \LambdaClass child of the \FunctionDefinition is required, it must have the same number of \token{bvar} children as the \DrawFromDistribution has \Input children.  They do not, however, have to have the same IDs:  the \token{bvar} ids are defined as being local to the \LambdaClass function in much the same way that the \Input IDs are defined as being local to the \DrawFromDistribution object.

The value \val{x} may not be used as an \primtype{UncertId} in an \Input element; that symbol is reserved for use by the \ExplicitPDF element (see \ref{explicitPDF-class}).

\subsection{The \class{PredefinedPDF} class}
\label{predefinedPDF-class}

The \PredefinedPDF class, like the \Math class of many \sbmlthreecore elements, is a container for UncertML XML.  It must contain one of the 28 'Distribution' elements defined at \url{http://uncertml.org/dictionary}, and have the namespace \val{http://uncertml.org/3.0}.  Note that as of this writing, UncertML is only formally defined through version 2.0, making this use of version 3.0 somewhat speculative.  However, the \distribshort Package Working Group has been in communication with the developers of UncertML, and feel certain that the change needed in UncertML to accomodate its use in this package (namely, the possible substitution of IDs for numbers) will be made for UncertML 3.0.

When a \PredefinedPDF is encountered, its parent \FunctionDefinition is defined as sampling from the defined distribution, and returning that sample.  There must be no undefined IDs within the \PredefinedPDF; all IDs must have a corresponding \Input for the function.

The full list of distributions and how they can be used is provided in \ref{sec:uncertmlusage}.  Four of these distributions (Dirichlet, Multinomial, Multivariate Normal, and Multivariate Student T) use vectors as both input and output.  It is possible, if tedious, to provide vector input to these distributions by simply defining each element of the required vector as a numeric value or as an \primtype{UncertId}.  However, it is not possible in \sbmlthreecore to take a single vector and simultaneously assign its values to different elements, or even to use a vector within MathML.  While it would be theoretically possible to define new elements in this specification to work around this limitation, such capabilities are more obviously the domain of the Arrays package within SBML, or of SED-ML\footnote{\url{http://sed-ml.org/}} (to set a suite of element values).  Unfortunately, as of this writing, the Arrays package has not yet been finalized, and many aspects of it have not been set.  Therefore, it is left to the future finalized Arrays package to define how to utilize a \FunctionDefinition that returns a vector, and how to define a \FunctionDefinition that takes a vector as input.  It is also possible for other individuals or groups to come up with custom annotations that define how to do this, and in fact, this is encouraged for any group that requires the use of any of these four distributions for their models.  If no such definitions exist, however, any numerical results from the use of these functions remain undefined, and therefore unsimulatable.  (Such models may still be useful descriptions of certain situations, however.)  A final possibility is that SED-ML could be extended to extract the function definition, perform the sampling itself, and use the resulting vector to assign initial values to certain elements.

\subsection{The \class{ExplicitPMF} class}
\label{explicitPMF-class}

The \ExplicitPMF class is also container for UncertML XML.  It must contain one of the three 'Samples' elements defined at \url{http://uncertml.org/dictionary} (RandomSample, SystematicSample, or UnknownSample), and have the namespace \val{http://uncertml.org/3.0}.  As is the case for the \PredefinedPDF class above, as of this writing, UncertML is only formally defined through version 2.0, making this use of version 3.0 somewhat speculative.  However, the \distribshort Package Working Group has been in communication with the developers of UncertML, and feel certain that the change needed in UncertML to accomodate its use in this package (namely, the possible substitution of IDs for numbers) will be made for UncertML 3.0.

All three Sample elements in UncertML are logistically identical, and only semantically different.  The RandomSample describes a set of realizations known to come from a randomly-distributed source.  The SystematicSample describes a set of deliberately chosen realizations, such as those resulting from unscented sampling methods for Gaussian random variables.  The UnknownSample describes a set of realizations for which the source distribution is unknown.  All three describe a set of realizations, each with a weight and one or more values. The weights of all realizations in a single Sample must sum to 1.0.

UncertML also allows the definition of realizations with \val{categories} instead of \val{values} (i.e. \primtype{strings} instead of \primtype{doubles}).  This data type is unsupported in\sbmlthreecore, but if a package supports this data type in the future (as the Qualitative Models package might), \val{categories} could be used.

When an \ExplicitPMF is encountered, its parent \FunctionDefinition is defined as randomly choosing a single realization from the the \uncertml according to its \token{weight}, and, if the realization contains a \token{values} child, returning that value (or vector of values) when the function is called.  If the realization contains a \token{categories} child, that string (or vector of strings) is returned instead.  (\uncertml requires that a single realization contain either a \token{values} or \token{categories} child, but may not have both.)  There must be no undefined IDs within the \ExplicitPMF; all IDs must have a corresponding \Input for the function.

As happens with some of the UncertML distributions above, then, if the chosen realization has multiple values or categories, the result of the draw is a vector, which cannot, in \sbmlthreecore, be used either in MathML or as an assignment to an SBML element.  The Arrays package or some form of custom annotation must be used to define what happens when a multi-value realization is chosen.

Note \notice that the \ExplicitPMF class in previous versions of this specification did not use \uncertml, and instead defined their own way of listing samples.  The functionality (with the addition of IDs instead of numbers in \uncertml 3.0) is identical.


\subsection{The \class{ExplicitPDF} class}
\label{explicitPDF-class}

The \ExplicitPDF class is a container for MathML XML.  It must define a function, using the same MathML allowed in the rest of the SBML Document, for the value \val{x} that integrates to 1.0 over all \token{x}, and which never evaluates to a negative value for any \token{x}.  It may also use the \primtype{UncertIDRef} identifiers defined by its sibling \Input elements, and the \primtype{SId}s of any other \FunctionDefinition, but no other identifier.  For this reason, \val{x} is illegal to use as an \primtype{UncertId} in any \Input element in the model:  it is reserved for use by the \ExplicitPDF class.  As is the case in \sbmlthreecore, circular function definitions are illegal: the \primtype{SId} of a \FunctionDefinition may not be used in its own child \ExplicitPDF, nor may it use the \primtype{SId} of a \FunctionDefinition that references itself, etc.

To draw a value from an explicit PDF, choose a value between 0 and 1 (non-inclusive), and integrate the function from x=-infinity until your chosen value is reached, and return the value of x at that point.  For example, if you chose the value 0.5 when integrating an explicit Gaussian function, you would return the mean of that function.


\subsection{Discrete vs. continuous sampling}
\label{discrete-continuous}

The \primtype{SId}s of \FunctionDefinition elements can be used in \sbmlthreecore in both discrete and continuous contexts:  \InitialAssignment, \EventAssignment, \Priority, and \Delay elements are all discrete, while \Rule, \KineticLaw, and \Trigger elements are all continuous in time.  For discrete contexts, the behavior of \distribshort-extended \FunctionDefinition elements is well-defined:  one or more random values are sampled from the distribution each time the function definition is invoked. Each invocation implies one sampling operation.  In continuous contexts, however, their behavior is ill-defined.  More information than is defined in this package (such as autocorrelation values or full conditional probabilities) would be required to make random sampling tractable in continuous contexts, and is beyond the scope of this version of the package.  If some package is defined in the future that adds this information, or if custom annotations are provided that add this information, such models may become simulatable.  However, this package does not define how to handle sampling in continuous contexts, and recommends against it.  Assuming such models are desirable, and the information is not provided in a separate package, this information may be incorporated into a future version of this specification.

Any other package that defines new contexts for MathML will also either be discrete or continuous.  Discrete situations (such as those defined in the Qualitative Models package) are, as above, well-defined.  Continuous situations (as might arise within the Spatial Processes package, over space instead of over time) will most likely be ill-defined.  Those packages must therefore either define for themselves how to handle \distribshort-extended \FunctionDefinition elements, or leave it to some other package/annotation scheme to define how to handle the situation.

\subsection{Truncation}
\label{truncation}

Earlier versions of this specification allowed one to specify truncation values for UncertML distributions and explicit PDFs:  upper and lower limits to the distributions, between which values must be sampled.  However, this capability is being introduced in UncertML 3.0, making truncation elements superfluous for \PredefinedPDF elements, and explicit PDFs can be constructed to be truncated through the use of the \token{piecewise} \mathml construct, making truncation elements superfluous for \ExplicitPDF elements as well.  Truncation was never considered for inclusion for \ExplicitPMF functions, as truncating a sample is as simple as not including the rejected realizations.  Therefore, since its capabilities are duplicated elsewhere, truncation-specific elements have been dropped from this version of the specification.

\emph{Note: \notice If the truncation elements were desired as a form of annotation, denoting the range between which most, if not all, of a given distribution would fall, that capability is not replicated in the other functions above, and would need to be re-added to this specification.}

\subsection{Examples using the extended \FunctionDefinition}
\label{sec:fd-examples}

Several examples are given below that illustrate various uses of an extended \FunctionDefinition.

\subsubsection{Defining and using a normal distribution with UncertML}
In the following example, a \FunctionDefinition is extended to define a draw from an UncertML-defined normal distribution:

\begin{example}
...
  <listOfFunctionDefinitions>
    <functionDefinition id="normal">
      <math xmlns="http://www.w3.org/1998/Math/MathML">
        <!-- Overridden MathML -->
      </math>
      <drawFromDistribution xmlns="http://www.sbml.org/sbml/level3/version1/groups/version1">
         <input> avg </input>
         <input> var </input>
         <predefinedPDF xmlns:un="http://uncertml.org/3.0">
           <un:NormalDistribution>
             <un:mean> avg </un:mean>
             <un:variance> var </un:variance>
           </un:NormalDistribution>
         </predefinedPDF>
      </drawFromDistribution>
    </functionDefinition>
  </listOfFunctionDefinitions>
...
\end{example}

Here, the \Input children of \DrawFromDistribution define the local \primtype{UncertId}s \val{avg} and \val{var}, which are then used by the \PredefinedPDF as the \token{mean} and \token{variance} of a normal distribution, as defined by UncertML.  This function could then be used anywhere the \FunctionDefinition id \val{normal} can be used, as for example in an \InitialAssignment:

\begin{example}
...
  <listOfInitialAssignments>
    <initialAssignment symbol="y">
      <math xmlns="http://www.w3.org/1998/Math/MathML">
        <apply>
          <ci> normal </ci>
          <ci> z </ci>
          <cn type="integer"> 10 </cn>
        </apply>
      </math>
    </initialAssignment>
  </listOfInitialAssignments>
...
\end{example}

This use would apply a draw from a normal distribution with mean \val{z} and variance \val{10} to the SBML element \val{y}.

\subsubsection{Defining a normal distribution with an explicit PDF}
In the following example, a \FunctionDefinition is extended to define a draw from a normal distribution defined in MathML, with \val{x} as the variable to be sampled.  The normal distibution equation is described in \ref{fig:normalequation}.

\begin{figure}[htb]
\includegraphics[width=0.2\linewidth]{gaussian_distribution_function.png}
\caption{The equation for a normal distribution.}
\label{fig:normalequation}
\end{figure}


\begin{example}
...
  <listOfFunctionDefinitions>
    <functionDefinition id="normal">
      <math xmlns="http://www.w3.org/1998/Math/MathML">
        <!-- Overridden MathML -->
      </math>
      <drawFromDistribution xmlns="http://www.sbml.org/sbml/level3/version1/groups/version1">
         <input> avg </input>
         <input> var </input>
         <explicitPDF>
            <apply>
              <times/>
              <apply>
                <divide/>
                <cn type="integer"> 1 </cn>
                <apply>
                  <times/>
                  <ci> v </ci>
                  <apply>
                    <root/>
                    <degree>
                      <cn type="integer"> 2 </cn>
                    </degree>
                    <apply>
                      <times/>
                      <cn type="integer"> 2 </cn>
                      <pi/>
                    </apply>
                  </apply>
                </apply>
              </apply>
              <apply>
                <exp/>
                <apply>
                  <times/>
                  <apply>
                    <divide/>
                    <apply>
                      <power/>
                      <apply>
                        <minus/>
                        <apply>
                          <minus/>
                          <ci> x </ci>
                          <ci> mean </ci>
                        </apply>
                      </apply>
                      <cn type="integer"> 2 </cn>
                    </apply>
                    <cn type="integer"> 2 </cn>
                  </apply>
                  <apply>
                    <power/>
                    <ci> v </ci>
                    <cn type="integer"> 2 </cn>
                  </apply>
                </apply>
              </apply>
            </apply>
         </explicitPDF>
      </drawFromDistribution>
    </functionDefinition>
  </listOfFunctionDefinitions>
...
\end{example}

Again, the \Input children of \DrawFromDistribution define the local \primtype{UncertId}s \val{avg} and \val{var}.  Here, they are used by the \ExplicitPDF as the \token{mean} and \token{variance} of a normal distribution of \val{x}.  This function could then be used anywhere the \FunctionDefinition id \val{normal} can be used, exactly as above.


\subsubsection{Defining a 'die roll' sample with UncertML}
In the following example, a \FunctionDefinition is extended to define a draw from an UncertML-defined set of explicitPMFs:

\begin{example}
...
  <listOfFunctionDefinitions>
    <functionDefinition id="rolld4">
      <math xmlns="http://www.w3.org/1998/Math/MathML">
        <!-- Overridden MathML -->
      </math>
      <drawFromDistribution xmlns="http://www.sbml.org/sbml/level3/version1/groups/version1">
         <sample xmlns:un="http://uncertml.org/3.0">
           <un:RandomSample>
             <un:Realisation>
               <un:weight> 0.25 </un:weight>
               <un:values> 1 </un:values>
             </un:Realisation>
             <un:Realisation>
               <un:weight> 0.25 </un:weight>
               <un:values> 2 </un:values>
             </un:Realisation>
             <un:Realisation>
               <un:weight> 0.25 </un:weight>
               <un:values> 3 </un:values>
             </un:Realisation>
             <un:Realisation>
               <un:weight> 0.25 </un:weight>
               <un:values> 4 </un:values>
             </un:Realisation>
         </sample>
      </drawFromDistribution>
    </functionDefinition>
  </listOfFunctionDefinitions>
...
\end{example}

No inputs are provided.  The four \token{Realisation} children of \token{RandomSample} all have equal values for \token{weight}, and sum to 1.0, as they must.  The \token{values} of each are equally likely to be chosen, therefore, resulting in this function returning \val{1}, \val{2}, \val{3}, or \val{4}, each with equal probability.



\subsubsection{Defining a 'pick one' sample with UncertML}
In the following example, a \FunctionDefinition is extended to define a draw from an UncertML-defined set of samples:

\begin{example}
...
  <listOfFunctionDefinitions>
    <functionDefinition id="pickone">
      <math xmlns="http://www.w3.org/1998/Math/MathML">
        <!-- Overridden MathML -->
      </math>
      <drawFromDistribution xmlns="http://www.sbml.org/sbml/level3/version1/groups/version1">
         <input> A </input>
         <input> B </input>
         <input> C </input>
         <input> D </input>
         <sample xmlns:un="http://uncertml.org/3.0">
           <un:RandomSample>
             <un:Realisation>
               <un:weight> 0.25 </un:weight>
               <un:values> A </un:values>
             </un:Realisation>
             <un:Realisation>
               <un:weight> 0.25 </un:weight>
               <un:values> B </un:values>
             </un:Realisation>
             <un:Realisation>
               <un:weight> 0.25 </un:weight>
               <un:values> C </un:values>
             </un:Realisation>
             <un:Realisation>
               <un:weight> 0.25 </un:weight>
               <un:values> D </un:values>
             </un:Realisation>
         </sample>
      </drawFromDistribution>
    </functionDefinition>
  </listOfFunctionDefinitions>
...
\end{example}

In this example, the function 'pickone' is defined, with four arguments, \val{A}, \val{B}, \val{C}, and \val{D}.  When called, each argument has an equal chance of being chosen as the return value.


\subsection{Equivalence with Fallback Function}
\label{sec:fallbackfunc}

The \mathml definition directly contained by the
\class{functionDefinition} is not used and is provided to
satisfy the \emph{validity upon reduction} rule for packages
\cite{sbmll3v1packrule}. This rules states that the SBML document must
be syntactically valid if all package specific elements are removed
from it. To ensure that this is the case the fallback function used in
relation to \distribshort must satisfy the following rules:

\begin{itemize}
\item the lambda function should have the same number of arguments as
  its equivalent distribution (defined by \distribshort).
\item Each argument should match the type of the equivalent argument
  in the external function.
\item The lambda function should have the same return type as the
  \emph{sampled} distribution. For example, if a predefined PDF when
  sampled returns a scalar value, the dummy function should also do so.
\end{itemize}

Clearly these rules can only be enforced by a \distribshort aware validator.

In the following example, the fallback function is coded to simply return \val{mean}, the first argument of the function.  Note that the arguments have been given different local IDs (\val{mean} and \val{v} instead of \val{avg} and \val{var}); their equivalence is based on place, not string matching.

\begin{example}
  <listOfFunctionDefinitions>
    <functionDefinition id="normal">
      <math xmlns="http://www.w3.org/1998/Math/MathML">
        <lambda>
          <bvar>
            <ci> mean </ci>
          </bvar>
          <bvar>
            <ci> v </ci>
          </bvar>
          <ci> mean </ci>
        </lambda>
      </math>
      <drawFromDistribution xmlns="http://www.sbml.org/sbml/level3/version1/groups/version1">
         <input> avg </input>
         <input> var </input>
         <predefinedPDF xmlns:un="http://uncertml.org/3.0">
           <un:NormalDistribution>
             <un:mean> avg </un:mean>
             <un:variance> var </un:variance>
           </un:NormalDistribution>
         </predefinedPDF>
      </drawFromDistribution>
    </functionDefinition>
  </listOfFunctionDefinitions>
\end{example}

\subsection{The extended \SBase class}
\label{sec:extended-sbase-class}

As can be seen in \fig{extended-sbase-uml}, 

\begin{figure}[bh]
  \includegraphics{extended-sbase}
  \caption{The definition of the extended \SBase class to include a new optional \Uncertainty child.  May be used for any element with mathematical meaning, or with a \Math child.}
  \label{extended-sbase-uml}
\end{figure}


\subsection{The \class{Uncertainty} class}
\label{uncertainty-class}



\section{Interaction with other packages}

This package is dependent on no other package, but relies on the \arrays package
to provide array and matrix structures if those are desired/used.

If the \req package is used, any \FunctionDefinition that has been given an \DrawFromDistribution child must be given a \MathChangedDeclaration child referencing this package's namespace.  If the fallback function provides a complete \LambdaClass function, its \token{viableWithoutChange} atribute \emph{may} be set \val{true} if the modeler considers that function an acceptable alternative to the draw from the distribution, otherwise it must be set \val{false}.

\section{Use-cases and examples}

\subsection{Sampling from a distribution: PK/PD Model}

This is a very straightforward use of an externally defined
distribution. The key point to note is that a value is sampled from
the distribution and assigned to a variable when it is invoked. In the
initialAssignments element in this example. Later use of the variable
does not result in re-sampling from the distribution. This is
consistent with current SBML semantics.

\exampleFile{examples/pkpd.xml}

\subsection{Truncated distribution}
\label{sec: truncated-eg}

To encode a truncated distribution we rely on external
definitions. Clearly it would be cumbersome if every distribution and
multivariate distribution required a truncated equivalent definition,
but at present this is what is required\controversial. Perhaps this
problem could be solved if optional function arguments were permitted,
but this causes problems with the fallback function (see \ref{sec:unresolved}).

\exampleFile{examples/truncated_distn.xml}

\subsection{Multivariate distribution}

In this example two correlated parameters are sampled from a
multivariate distribution. The correlation is defined using a
covariance matrix and the sampled values are returned as a vector of 2
values, which are then assigned to the individual parameters. This
example relies heavily on the \arraysshort package, which will be a
dependency of the \distribshort package. Note that because the
\arraysshort proposal is under development this example may be
completely consistent with it.

\exampleFile{examples/mutivariate_example.xml}

\subsection{User-defined continuous distribution }

In this example an additional construct is used to indicate:
\begin{itemize}
\item that the \mathml within the function definition defines a PDF and so is not a
fallback.
\item that when invoked a value should be sampled from this PDF.
\end{itemize}

\exampleFile{examples/user-defined.xml}


\subsection{User-defined discrete distribution}
\label{sec:userDefinedDiscrete}

In this example we don't use any special distrib features, by invoke
an externally defined function that constructs a PMF from a matrix of
values and their associated probabilities. The example is not
biologically meaningful, but illustrates that the matrix contains the
values and probabilities possible when throwing two dice. These values
are encoded in a matrix, which is passed as a parameter in a function,
however, it may be that this information is defined using
\numl\controversial or by referring to an external file.

There has been very little discussion\controversial{} about how to treat user-defined
PMFs so this example should be regarded as a starting point for
discussion rather than a final proposal.

\exampleFile{examples/user-defined-pmf.xml}

\section{Prototype implementations}

None as yet.

\section{Unresolved issues}
\label{sec:unresolved}

\begin{enumerate}
\item Should the \class{explicitPDF} class have a truncation
  attribute. This would allow one to define a truncated distribution
  without defining the truncated PDF in the \mathml definition. Is
  this desirable or not?
\item Currently the proposal provides an appendix that clarifies the
  parameters that should be specified for each \uncertml distribution and their
  type. It also defines whether one or more values are sampled from a
  given distribution. There was some argument on the list about
  whether this appendix is required. An alternative would be to use
  \uncertml definitions as-is, and live with any inherent
  ambiguity. We should make a decision about the approach we want to
  take for the final version of this proposal.
\item The use of arrays. The package and examples have been written
  that some distribution definitions will require the use of vector or
  matrix types that can be provided by the Arrays package. While
  relying on such types enables us to describe a wide range of
  probability distributions this will come at the cost of delaying
  this package's approval until Arrays has been developed and
  approved. There are two alternative strategies. One is to only
  support distributions that do not require array types (see appendix
  \ref{sec:uncertmlusage}). The other would be to define workarounds
  within \distribshort to provide array structures without using the
  arrays package. The decision at COMBINE was to wait. Do we want to
  revisit this decision?
\item Currently sampling of distributions in permitted in the event
  related elements of SBML: EventAssignments, Delays and
Priorities. The reason for prohibiting sampling in a rate law (or other
circumstances where the model is being continuously evaluated) was
because this can make the simulation unstable\footnote{See slide entitled Extrinsic
  noise:
  \url{http://sbml.org/images/3/3b/Djw-sbml-hackathon-2010-05-04.pdf}.}. It
is unclear whether a similar situation could arise while sampling from
events. The author feels this need to be looked into further by 'who
know'.

\item During the review of this proposal it was questioned whether the
  use of the term PMF was appropriate for the eponymous \distribshort
  class: \class{userDefinedPMF}. The issue is that a PMF is defined
  for (numerical) values which a random variable can assume and not
  general 'categories'. Since we permit non-numerical values to define
  categories such as eye colour (red, green, blue etc.) or sex (M, F)
  it is argued that the current name is mis-leading. \uncertml uses
  the term discrete probability for a similar construct that describes
  this, so perhaps a better class name would be
  \class{UserDefinedDiscreteProbability} or just
  \class{DiscreteProbability}.

\item Limiting the use of \class{FunctionDefinition}. In review it was
  pointed out that the restriction on sampling to InitialAssignent,
  EventAssignment etc. affects MathML validity rules in SBML. Currently
  a function definition can be 'called' from any \mathml block in an
  SBML document. However, \distribshort imposes an additional special
  case. \emph{A function definition that defines a distribution can
    only be called from \mathml, where sampling is permitted.} It is
  not absolutely clear what the technical implications of this are,
  but it would appear that to implement \distribshort support any
  implementation would be required to modify the \mathml validation
  rules in libSBML. Given, that these rules are not designed to
  interact with packages this may be technically challenging to
  implement. The author feels that it would be desirable to find an
  alternative design that avoids the need to modify the \mathml
  validation rules.
\end{enumerate}

\section{Acknowledgements}
\label{sec:acknowledgements}

Much of the initial concrete work leading to this proposal document
was carried out at the Statistical Models Workshop in Hinxton in 2011,
which was organised by Nicolas le Nov\`{e}re. A list of participants
and recordings of the discussion is available from
\url{http://sbml.org/Events/Other_Events/statistical_models_workshop_2011}.
Before that a lot of the ground work was carried out by Darren
Wilkinson who led the discussion on \distribshort at the Seattle SBML
Hackathon and before that Colin Gillespie who wrote an initial
proposal back in 2005. The author would also like to thank the
participants of the \distribshort sessions during HARMONY 2012 and
COMBINE 2012 for their excellent contributions in helping revising
this proposal; Sarah Keating, Maciej Swat and Nicolas le Nov\`{e}re
for useful discussions, corrections and review comments; and Mike
Hucka for \LaTeX{} advice and the beautiful template upon which this
document is based.

\appendix
\section{Distributions incorporated from \uncertml}
\label{sec:uncertmlusage}

The distributions described by \uncertml \footnote{These
  distributions are defined here:
  \url{http://www.uncertml.org/distributions}} will provide the
standard external definition of distributions used by \distrib. The
definitions are comprehensive, but have multiple implicit definitions
in some cases. For example the mean and variance parameters of the
Normal distribution can be each be described as a vector of $k$
values, where each mean, variance pair describes a different
probability distribution. However, in \distribshort we want to define
one probability density and so it in necessary to disambiguate
definitions where more than one is possible.

The table below describes, for each probability distribution defined in
\uncertml: the arguments (referred to as parameters in \uncertml) it
takes, the type of each argument and type of the result obtained when
a random value (or values) is sampled from the distribution. The type
can be either a scalar (in effect a double because this is the only
scalar type supported by SBML), or an array (again of doubles), which
can have one or more dimensions.

%\begin{center}
\begin{longtable}[c]{ l l l l }
\toprule
\textbf{\uncertml Name} & \multicolumn{2}{c}{\textbf{Argument}} & \textbf{Sampled Result} \\
\cmidrule(r){2-3}
& \textbf{Name} & \textbf{Type} & \\
\toprule 
\endhead
\cmidrule(r){3-4}
\multicolumn{4}{r}{Continued on next page...}\\
\endfoot
\bottomrule
\endlastfoot
 BernouliDistribution & probability & scalar & scalar \\\midrule
BetaDistribution & alpha & scalar & scalar \\
                          & beta & scalar & \\\midrule
BinomialDistribution & numberOfTrials & scalar & scalar\\
                                 & probabilityOfSuccess & &\\\midrule
CauchyDistribution & location & scalar & scalar \\
                                 & scale & scalar & \\\midrule
ChiSquaredDistribution & degreesOfFreedom & scalar & scalar \\\midrule
DirichletDistribution & concentration & array[k], $k \ge 2$ & array[k] \\\midrule
ExponentialDistribution & rate & scalar & scalar \\\midrule
FDistribution & numerator & scalar & scalar \\
                       & denominator & scalar & \\\midrule
GammaDistribution & shape & scalar & scalar \\
                                & scale & scalar &  \\\midrule
GeometricDistribution & probability & scalar & scalar \\\midrule
HypergeometricDistribution & populationSize & scalar & scalar \\
                                             & numberOfTrials & scalar &\\
                                             & numberOfSuccesses & scalar &\\\midrule
InverseGammaDistribution & shape & scalar & scalar \\
                                & scale & scalar &  \\\midrule
LaplaceDistribution & location & scalar & scalar\\
                                  & scale & scalar & \\\midrule
LogNormalDistribution & logScale & scalar & scalar \\
                                     & shape & scalar & \\\midrule
LogisticDistribution & location & scalar & scalar \\
                                & scale & scalar & \\\midrule
MixtureModel & weight & ? & ? \\\midrule
MultinomialDistribution & numberofTrials & scalar & array[k]\\
                                       & probabiltyOfSuccess &
                                       array[k]\\\midrule
MultivariateNormalDistribution & mean & array[k] & array[k] \\
                                                  & covarianceMatrix & array[k][k] & \\\midrule
MultivariateStudentTDistribution & mean & array[k] & array[k] \\
                                                         & covarianceMatrix & array[k][k]\\
                                                         &
                                                         degreesOfFreedom
                                                         & scalar
                                                         \\\midrule
NegativeBinomialDistribution & numberOfFailures & scalar & scalar \\
                                               & probability & scalar
                                               & \\\midrule
NormalDistribution & mean & scalar & scalar \\
                                & variance & scalar & \\\midrule
NormalInverseGammaDistribution & mean & scalar & scalar\\
                                                       &
                                                       varianceScaling
                                                       & \\
                                                       & shape &\\
                                                       & scale & \\\midrule
ParetoDistribution & scale & scalar & scalar \\
                                & shape & scalar & \\\midrule
PoissionDistribution & rate & scalar & scalar \\\midrule
StudentTDistribution & location & scalar & scalar \\
                                    & scale & scalar & \\
                                    & degreesOfFreedom & scalar &
                                    \\\midrule
WeibullDistribution  & scale & scalar & scalar \\
                                     & shape & scalar & \\\midrule
WishartDistribution & scaleMatrix & scalar & scalar \\
                                  & degreesOfFreedom & scalar & \\
%\bottomrule
\end{longtable}
%\end{center}

\bibliography{sbml-level-3-distrib-package-proposal}


\end{document}

